<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="codestyle python," />





  <link rel="alternate" href="/atom.xml" title="任性的雨" type="application/atom+xml" />






<meta name="description" content="Python编程规范  1 背景 ​        Python是一门动态语言。Python有着非常自由的语法和非常多的特性，开发者可以写出各种充满社会特色主义的代码。本规范的目的不是为了约束开发者的创造力和生产力，而是为了限制开发者的过度个性化，统一团队的代码风格，通过风格一致的代码来更好地进行团队成员之间的协作开发。本规范适用Python3.5以上的版本，部分规范在Python2.7不一定适">
<meta name="keywords" content="codestyle python">
<meta property="og:type" content="article">
<meta property="og:title" content="Python编码风格规范">
<meta property="og:url" content="http://nikan1996.coding.me/2018/07/30/PythonCodeStyle/Python编码风格规范/index.html">
<meta property="og:site_name" content="任性的雨">
<meta property="og:description" content="Python编程规范  1 背景 ​        Python是一门动态语言。Python有着非常自由的语法和非常多的特性，开发者可以写出各种充满社会特色主义的代码。本规范的目的不是为了约束开发者的创造力和生产力，而是为了限制开发者的过度个性化，统一团队的代码风格，通过风格一致的代码来更好地进行团队成员之间的协作开发。本规范适用Python3.5以上的版本，部分规范在Python2.7不一定适">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-01-29T18:18:03.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Python编码风格规范">
<meta name="twitter:description" content="Python编程规范  1 背景 ​        Python是一门动态语言。Python有着非常自由的语法和非常多的特性，开发者可以写出各种充满社会特色主义的代码。本规范的目的不是为了约束开发者的创造力和生产力，而是为了限制开发者的过度个性化，统一团队的代码风格，通过风格一致的代码来更好地进行团队成员之间的协作开发。本规范适用Python3.5以上的版本，部分规范在Python2.7不一定适">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://nikan1996.coding.me/2018/07/30/PythonCodeStyle/Python编码风格规范/"/>





  <title>Python编码风格规范 | 任性的雨</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?9d7f914d8a055b12ac95dca1b8d3539f";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">任性的雨</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://nikan1996.coding.me/2018/07/30/PythonCodeStyle/Python编码风格规范/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Leo Ni">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://qiniu-blog.cyhlucky.club/fengbaobao.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="任性的雨">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Python编码风格规范</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-30T14:54:21+08:00">
                2018-07-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/07/30/PythonCodeStyle/Python编码风格规范/" class="leancloud_visitors" data-flag-title="Python编码风格规范">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="python编程规范"><a class="markdownIt-Anchor" href="#python编程规范"></a> Python编程规范</h1>
<h2 id="1-背景"><a class="markdownIt-Anchor" href="#1-背景"></a> 1 背景</h2>
<p>​        Python是一门动态语言。Python有着非常自由的语法和非常多的特性，开发者可以写出各种充满社会特色主义的代码。本规范的目的不是为了约束开发者的创造力和生产力，而是为了限制开发者的过度个性化，统一团队的代码风格，通过风格一致的代码来更好地进行团队成员之间的协作开发。本规范适用Python3.5以上的版本，部分规范在Python2.7不一定适用。本规范也不推荐开发者继续使用Python2.7开发，Python3会不断地加入新的特性，而Python2.7 到2020年1月1日后将停止被维护。本规范将辅助开发者写出简洁、优雅、高效和风格一致的代码，并且减少踩坑的概率，提升代码的质量，增强开发者的编程规范意识。</p>
<p>​        本规范主要参照<a href="https://github.com/google/styleguide/blob/gh-pages/pyguide.md" target="_blank" rel="noopener">google code style</a>和 <a href="https://www.python.org/dev/peps/pep-0008/" target="_blank" rel="noopener">PEP-8</a>完成。</p>
<a id="more"></a>
<h2 id="2-语言规范"><a class="markdownIt-Anchor" href="#2-语言规范"></a> 2 语言规范</h2>
<h3 id="21-代码检查工具"><a class="markdownIt-Anchor" href="#21-代码检查工具"></a> 2.1 代码检查工具</h3>
<ul>
<li>flake8</li>
<li>IDE自带代码检查工具</li>
</ul>
<h4 id="211-解释"><a class="markdownIt-Anchor" href="#211-解释"></a> 2.1.1 解释</h4>
<p>代码检查工具可以找出代码中存在的明显的bug和风格问题。</p>
<h4 id="212-优点"><a class="markdownIt-Anchor" href="#212-优点"></a> 2.1.2 优点</h4>
<p>可以找出容易忽略的错误，比如单词拼写错误， 使用了未被赋值的变量等。</p>
<h4 id="213-缺点"><a class="markdownIt-Anchor" href="#213-缺点"></a> 2.1.3 缺点</h4>
<p>代码检查工具不是万能的， 有些warning可能是不对的，在必要的时候可以忽略它们。</p>
<h4 id="214-推荐"><a class="markdownIt-Anchor" href="#214-推荐"></a> 2.1.4 推荐</h4>
<p>确保你写的代码经过了代码检查工具的检查，并忽略不必要的warning。</p>
<h3 id="22-导入imports"><a class="markdownIt-Anchor" href="#22-导入imports"></a> 2.2 导入(Imports)</h3>
<p>使用<code>import</code>来导入。</p>
<h4 id="221-解释"><a class="markdownIt-Anchor" href="#221-解释"></a> 2.2.1 解释</h4>
<p>模块间的代码复用。</p>
<h4 id="222-优点"><a class="markdownIt-Anchor" href="#222-优点"></a> 2.2.2 优点</h4>
<p>命名空间管理约定简单。<code>x.Obj</code>表示<code>Obj</code>对象在模块<code>x</code>中。</p>
<h4 id="223-缺点"><a class="markdownIt-Anchor" href="#223-缺点"></a> 2.2.3 缺点</h4>
<p>绝对导入在嵌套和命名复杂的情况下， 导入代码会变得非常长。</p>
<h4 id="224-推荐"><a class="markdownIt-Anchor" href="#224-推荐"></a> 2.2.4 推荐</h4>
<ul>
<li>
<p>使用<code>import x</code>来导入包和模块。</p>
</li>
<li>
<p>使用<code>from x import y</code>当x是包名， y是模块名，模块名最好不要包含前缀。</p>
</li>
<li>
<p>使用<code>from x import y as z</code>,如果y已经被导入了，为了避免重名，重命名为z。</p>
</li>
<li>
<p>使用<code>from x.y import a, b, c</code> x是包名,y是模块名， a,b,c是类，方法或者变量名。</p>
</li>
<li>
<p>使用<code>import y as z</code>，只有业界都这么做的时候才这么做。(比如import numpy as np， 是通用的一个做法)</p>
</li>
<li>
<p>避免方法内的局部导入。(除非遇到循环引用的情况，这个时候需要检查是否必须只能循环引用，能不能拆分代码避免循环引用)</p>
<p>​</p>
</li>
</ul>
<h3 id="23-包packages"><a class="markdownIt-Anchor" href="#23-包packages"></a> 2.3 包(Packages)</h3>
<p>使用模块的绝对路径名来导入每个模块。</p>
<h4 id="231-解释"><a class="markdownIt-Anchor" href="#231-解释"></a> 2.3.1 解释</h4>
<p>包是按目录来组织模块的方法。</p>
<h4 id="232-优点"><a class="markdownIt-Anchor" href="#232-优点"></a> 2.3.2 优点</h4>
<p>避免模块名冲突，查找模块更加容易。</p>
<h4 id="233-缺点"><a class="markdownIt-Anchor" href="#233-缺点"></a> 2.3.3 缺点</h4>
<p>导入变得困难， 因为必须要带上整个包的路径。</p>
<h4 id="234-推荐"><a class="markdownIt-Anchor" href="#234-推荐"></a> 2.3.4 推荐</h4>
<p>使用绝对导入，不推荐使用相对导入。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Reference in code with complete name.</span></span><br><span class="line"><span class="keyword">import</span> absl.flags</span><br><span class="line"></span><br><span class="line"><span class="comment"># Reference in code with just module name (这种方法更好).</span></span><br><span class="line"><span class="keyword">from</span> absl <span class="keyword">import</span> flags</span><br></pre></td></tr></table></figure>
<h3 id="24-异常exceptions"><a class="markdownIt-Anchor" href="#24-异常exceptions"></a> 2.4 异常(Exceptions)</h3>
<p>异常需要小心使用。</p>
<h4 id="241-解释"><a class="markdownIt-Anchor" href="#241-解释"></a> 2.4.1 解释</h4>
<p>异常是一种跳出代码块的正常控制流来处理错误或者其他异常情况的方式。</p>
<h4 id="242-优点"><a class="markdownIt-Anchor" href="#242-优点"></a> 2.4.2 优点</h4>
<p>正常操作代码的控制流不会和处理错误的代码混合在一起。当某个特定异常发生的时候，控制流可以跳过。比如，一步跳出N个嵌套的函数，而不用继续执行错误的代码。</p>
<h4 id="243-缺点"><a class="markdownIt-Anchor" href="#243-缺点"></a> 2.4.3 缺点</h4>
<p>控制流可能会让人疑惑。在调用库的时候容易忽略一些错误情况。</p>
<h4 id="244-推荐"><a class="markdownIt-Anchor" href="#244-推荐"></a> 2.4.4 推荐</h4>
<ul>
<li>
<p>使用<code>raise MyError('Error message')</code> 或 <code>raise MyError()</code></p>
</li>
<li>
<p>充分利用内置的异常类。比如，如果你传递了一个负数，但是要求是一个正数，抛出一个<code>ValueError</code>。不要使用<code>assert</code>语句来验证公共API中参数的值。<code>assert</code>被用于确保内部的正确性，而不是为了强制正确的使用，也不是为了表明一些意外的事情发生。如果发生了意外，请使用<code>raise</code>语句。比如，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Yes:</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">ConnectToNextPort</span><span class="params">(self, minimum)</span>:</span></span><br><span class="line">    <span class="string">"""Connects to the next available port.  Returns the new minimum port."""</span></span><br><span class="line">    <span class="keyword">if</span> minimum &lt;= <span class="number">1024</span>:</span><br><span class="line">      <span class="keyword">raise</span> ValueError(<span class="string">'Minimum port must be greater than 1024.'</span>)</span><br><span class="line">    port = self._FindNextOpenPort(minimum)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> port:</span><br><span class="line">      <span class="keyword">raise</span> ConnectionError(<span class="string">'Could not connect to service on %d or higher.'</span> % (minimum,))</span><br><span class="line">    <span class="keyword">assert</span> port &gt;= minimum, <span class="string">'Unexpected port %d when minimum was %d.'</span> % (port, minimum)</span><br><span class="line">    <span class="keyword">return</span> port</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">No:</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">ConnectToNextPort</span><span class="params">(self, minimum)</span>:</span></span><br><span class="line">    <span class="string">"""Connects to the next available port.  Returns the new minimum port."""</span></span><br><span class="line">    <span class="keyword">assert</span> minimum &gt; <span class="number">1024</span>, <span class="string">'Minimum port must be greater than 1024.'</span></span><br><span class="line">    port = self._FindNextOpenPort(minimum)</span><br><span class="line">    <span class="keyword">assert</span> port <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span></span><br><span class="line">    <span class="keyword">return</span> port</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>库和包可以定义它们自己的异常。如果要这么做， 必须继承一个已有的异常类。异常名需要以<code>Error</code>结尾，</p>
</li>
<li>
<p>永远不要使用 <code>except:</code> 语句来捕获所有异常， 该语句将会捕获<code>SystemExit</code> 和<code>KeyboardInterrupt</code>异常，这样会很难通过Control-C中断程序， 并且会掩盖掉其它的异常。如果想要捕捉程序出错的异常，使用<code>except Exception as e:</code>。</p>
</li>
<li>
<p>尽量减少<code>try/except</code>块内的代码量。<code>try</code>的内容越多， 期望外的异常就越容易被触发。在这种情况下<code>try/except</code>块将隐藏真正的错误。</p>
</li>
<li>
<p>使用<code>finally</code>子句。无论有没有异常被抛出，<code>finally</code>子句内的代码都会被执行。对于需要执行清理操作的时候，这是非常有用的。比如，关闭一个文件。</p>
</li>
<li>
<p>当捕获异常时，使用<code>as</code>而不要使用逗号(python3不支持逗号)。比如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">raise</span> Error</span><br><span class="line"><span class="keyword">except</span> Error <span class="keyword">as</span> error:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
</ul>
<h3 id="25-全局变量global-variables"><a class="markdownIt-Anchor" href="#25-全局变量global-variables"></a> 2.5 全局变量(Global variables)</h3>
<p>避免全局变量</p>
<h4 id="251-解释"><a class="markdownIt-Anchor" href="#251-解释"></a> 2.5.1 解释</h4>
<p><code>模块级的变量</code>或<code>类变量</code></p>
<h4 id="252-优点"><a class="markdownIt-Anchor" href="#252-优点"></a> 2.5.2 优点</h4>
<p>偶尔有用。</p>
<h4 id="253-缺点"><a class="markdownIt-Anchor" href="#253-缺点"></a> 2.5.3 缺点</h4>
<p>导入时可能会改变模块行为，因为在首次导入模块时会对全局变量赋值。</p>
<h4 id="254-推荐"><a class="markdownIt-Anchor" href="#254-推荐"></a> 2.5.4 推荐</h4>
<p>避免使用全局变量。</p>
<p>例外：</p>
<ul>
<li>模块级常量。比如，<code>MAX_HOLY_HANDGRENADE_COUNT = 3</code>。常量单词需要全部大写并且用下划线连接。具体请查看<a href="">命名规范</a>。</li>
<li>如果需要，全局变量仅在模块内部可用，并在名字前加一个<code>_</code>。外部访问必须通过公共模块级函数来完成。</li>
</ul>
<h3 id="26-嵌套-局部-内部类和函数nestedlocalinner-classes-and-functions"><a class="markdownIt-Anchor" href="#26-嵌套-局部-内部类和函数nestedlocalinner-classes-and-functions"></a> 2.6 嵌套、局部、内部类和函数(Nested/Local/Inner Classes and Functions)</h3>
<p>当嵌套的局部方法或者类是允许的。</p>
<h4 id="261-解释"><a class="markdownIt-Anchor" href="#261-解释"></a> 2.6.1 解释</h4>
<p>一个类可以在方法、函数或类中被定义。一个函数可以在方法或函数中被定义。嵌套方法拥有对闭包变量<code>只读</code>的权限。</p>
<h4 id="262-优点"><a class="markdownIt-Anchor" href="#262-优点"></a> 2.6.2 优点</h4>
<p>允许写一点小的工具类和函数在局部(用于辅助一些操作)，方便直接调用。</p>
<p>比如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Foo</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">e</span><span class="params">(s)</span>:</span></span><br><span class="line">        sys.stderr.write(<span class="string">'ERROR: '</span>)</span><br><span class="line">        sys.stderr.write(s)</span><br><span class="line">        sys.stderr.write(<span class="string">'\n'</span>)</span><br><span class="line">    e(<span class="string">'I regret to inform you'</span>)</span><br><span class="line">    e(<span class="string">'that a shameful thing has happened.'</span>)</span><br><span class="line">    e(<span class="string">'Thus, I must issue this desultory message'</span>)</span><br><span class="line">    e(<span class="string">'across numerous lines.'</span>)</span><br><span class="line">Foo()</span><br></pre></td></tr></table></figure>
<h4 id="263-缺点"><a class="markdownIt-Anchor" href="#263-缺点"></a> 2.6.3 缺点</h4>
<p>嵌套和局部的类实例不能被序列化(pickled)。嵌套的方法和类不能被直接得测试。嵌套可能会让你的函数更长并减少可读性。</p>
<h4 id="264-推荐"><a class="markdownIt-Anchor" href="#264-推荐"></a> 2.6.4 推荐</h4>
<p>推荐使用。</p>
<h3 id="27-推导式和生成器表达式comprehensions-generator-expressions"><a class="markdownIt-Anchor" href="#27-推导式和生成器表达式comprehensions-generator-expressions"></a> 2.7 推导式和生成器表达式(Comprehensions &amp; Generator Expressions)</h3>
<p>适合在简单情况下使用。</p>
<h4 id="271-解释"><a class="markdownIt-Anchor" href="#271-解释"></a> 2.7.1 解释</h4>
<p>列表，字典和集合推导式和生成器表达式提供了一种简洁高效的方式来创造容器类和迭代器，而不必借助于传统的循环， <code>map()</code>, <code>filter()</code>, 或者是<code>lambada</code>。</p>
<h4 id="272-优点"><a class="markdownIt-Anchor" href="#272-优点"></a> 2.7.2 优点</h4>
<p>简单的推导式比其他<code>dict</code>, <code>list</code>或<code>set</code>的创建方法更加清晰简单。生成器表达式非常高效， 因为它们避免一次性创建整个列表。</p>
<h4 id="273-缺点"><a class="markdownIt-Anchor" href="#273-缺点"></a> 2.7.3 缺点</h4>
<p>复杂的推导式或生成器表达式会导致阅读障碍。</p>
<h4 id="274-推荐"><a class="markdownIt-Anchor" href="#274-推荐"></a> 2.7.4 推荐</h4>
<p>适合在简单情况下使用。 每个部分应该单独一行：映射(mapping)表达式， <code>for</code>语句， 过滤表达式。</p>
<p><strong>禁止</strong>多重<code>for</code>语句或者过滤表达式。在复杂情况下，使用循环。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Yes:</span><br><span class="line">  result = []</span><br><span class="line">  <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">      <span class="keyword">for</span> y <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">          <span class="keyword">if</span> x * y &gt; <span class="number">10</span>:</span><br><span class="line">              result.append((x, y))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">5</span>):</span><br><span class="line">      <span class="keyword">for</span> y <span class="keyword">in</span> xrange(<span class="number">5</span>):</span><br><span class="line">          <span class="keyword">if</span> x != y:</span><br><span class="line">              <span class="keyword">for</span> z <span class="keyword">in</span> xrange(<span class="number">5</span>):</span><br><span class="line">                  <span class="keyword">if</span> y != z:</span><br><span class="line">                      <span class="keyword">yield</span> (x, y, z)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> ((x, complicated_transform(x))</span><br><span class="line">          <span class="keyword">for</span> x <span class="keyword">in</span> long_generator_function(parameter)</span><br><span class="line">          <span class="keyword">if</span> x <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>)</span><br><span class="line"></span><br><span class="line">  squares = [x * x <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br><span class="line"></span><br><span class="line">  eat(jelly_bean <span class="keyword">for</span> jelly_bean <span class="keyword">in</span> jelly_beans</span><br><span class="line">      <span class="keyword">if</span> jelly_bean.color == <span class="string">'black'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">No:</span><br><span class="line">  result = [(x, y) <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>) <span class="keyword">for</span> y <span class="keyword">in</span> range(<span class="number">5</span>) <span class="keyword">if</span> x * y &gt; <span class="number">10</span>]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> ((x, y, z)</span><br><span class="line">          <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">5</span>)</span><br><span class="line">          <span class="keyword">for</span> y <span class="keyword">in</span> xrange(<span class="number">5</span>)</span><br><span class="line">          <span class="keyword">if</span> x != y</span><br><span class="line">          <span class="keyword">for</span> z <span class="keyword">in</span> xrange(<span class="number">5</span>)</span><br><span class="line">          <span class="keyword">if</span> y != z)</span><br></pre></td></tr></table></figure>
<h3 id="28-默认迭代器和操作符default-iterators-and-operators"><a class="markdownIt-Anchor" href="#28-默认迭代器和操作符default-iterators-and-operators"></a> 2.8 默认迭代器和操作符(Default Iterators and Operators)</h3>
<p>如果类支持默认的迭代器和操作符，那么就使用它们，比如列表，字典和文件。</p>
<h4 id="281-解释"><a class="markdownIt-Anchor" href="#281-解释"></a> 2.8.1 解释</h4>
<p>字典和容器类型，比如字典和列表，定义了默认的迭代器和成员关系操作符(<code>in</code>和<code>not in</code>)</p>
<h4 id="282-优点"><a class="markdownIt-Anchor" href="#282-优点"></a> 2.8.2 优点</h4>
<p>默认迭代器和操作符简单高效。它们直接调用相关操作，不会因为额外的调用方法而产生开销。使用默认操作符的函数是通用的。任何类都可以去选择实现相关方法来支持这些操作。</p>
<h4 id="283-缺点"><a class="markdownIt-Anchor" href="#283-缺点"></a> 2.8.3 缺点</h4>
<p>类似<code>in</code>和<code>not in</code> 无法直接判断该对象的类型，而如果使用 <code>has_key()</code>则意味着该对象是一个字典。</p>
<h4 id="284-推荐"><a class="markdownIt-Anchor" href="#284-推荐"></a> 2.8.4 推荐</h4>
<p>如果默认的类支持默认的迭代器和操作符，比如列表，字典和文件。内建容器类型也定义了迭代器方法。优先考虑这些方法，而不是用另外的返回列表的方法。请注意，在迭代容器的时候，你是不能对它进行修改的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Yes:  <span class="keyword">for</span> key <span class="keyword">in</span> adict: ...</span><br><span class="line">      <span class="keyword">if</span> key <span class="keyword">not</span> <span class="keyword">in</span> adict: ...</span><br><span class="line">      <span class="keyword">if</span> obj <span class="keyword">in</span> alist: ...</span><br><span class="line">      <span class="keyword">for</span> line <span class="keyword">in</span> afile: ...</span><br><span class="line">      <span class="keyword">for</span> k, v <span class="keyword">in</span> dict.iteritems(): ...</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">No:   <span class="keyword">for</span> key <span class="keyword">in</span> adict.keys(): ...</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">not</span> adict.has_key(key): ...</span><br><span class="line">      <span class="keyword">for</span> line <span class="keyword">in</span> afile.readlines(): ...</span><br></pre></td></tr></table></figure>
<h3 id="29-生成器generators"><a class="markdownIt-Anchor" href="#29-生成器generators"></a> 2.9 生成器(Generators)</h3>
<p>按需使用生成器。</p>
<h4 id="291-解释"><a class="markdownIt-Anchor" href="#291-解释"></a> 2.9.1 解释</h4>
<p>一个生成器函数返回一个迭代器。每当它执行一次yield语句，它就会返回一个值。生成值后，生成器函数的运行状态被挂起直到需要生成下一个值。</p>
<h4 id="292-优点"><a class="markdownIt-Anchor" href="#292-优点"></a> 2.9.2 优点</h4>
<p>简化代码， 因为每次调用时，局部变量和控制流的状态都会被保存。生成器仅会占用极少的内存，对于大内存对象的迭代，推荐使用生成器而不是列表。</p>
<h4 id="293-缺点"><a class="markdownIt-Anchor" href="#293-缺点"></a> 2.9.3 缺点</h4>
<p>无。</p>
<h4 id="294-推荐"><a class="markdownIt-Anchor" href="#294-推荐"></a> 2.9.4 推荐</h4>
<p>鼓励使用。</p>
<h3 id="210-匿名函数lambda-functions"><a class="markdownIt-Anchor" href="#210-匿名函数lambda-functions"></a> 2.10 匿名函数(Lambda Functions)</h3>
<p>适用于一行的表达式。</p>
<h4 id="2101-解释"><a class="markdownIt-Anchor" href="#2101-解释"></a> 2.10.1 解释</h4>
<p><code>Lambda</code>定义了以一个表达式作为匿名函数，经常用于回调和高阶函数比如<code>map()</code>，<code>filter()</code>。</p>
<h4 id="2102-优点"><a class="markdownIt-Anchor" href="#2102-优点"></a> 2.10.2 优点</h4>
<p>方便。</p>
<h4 id="2103-缺点"><a class="markdownIt-Anchor" href="#2103-缺点"></a> 2.10.3 缺点</h4>
<p>比本地函数更难阅读和调试。没有函数名意味着调用栈跟踪更加难以理解。由于python的lambda函数只能包含一个表达式，因此它的作用有限。</p>
<h4 id="2104-推荐"><a class="markdownIt-Anchor" href="#2104-推荐"></a> 2.10.4 推荐</h4>
<p>对于简单的表达式，可以直接使用匿名函数而不用再单独写一个函数。如果匿名函数代码超过60-80个字符，最好还是定义成单独的函数。对于常见的操作符，比如乘法，使用<code>operator</code>模块中的函数代替<code>lambda</code>函数。比如， 推荐使用<code>operator.mul</code>， 而不是<code>lambda x,y: x*y</code>。</p>
<h3 id="211-条件表达式conditional-expressions"><a class="markdownIt-Anchor" href="#211-条件表达式conditional-expressions"></a> 2.11 条件表达式(Conditional Expressions)</h3>
<h4 id="2111-解释"><a class="markdownIt-Anchor" href="#2111-解释"></a> 2.11.1 解释</h4>
<p>条件表达式(又被称为三元运算符)提供了比 <code>if</code>语句更短的语法。比如<code>x = 1 if cond else 2</code>。</p>
<h4 id="2112-优点"><a class="markdownIt-Anchor" href="#2112-优点"></a> 2.11.2 优点</h4>
<p>比if语句更加简短和方便。</p>
<h4 id="2113-缺点"><a class="markdownIt-Anchor" href="#2113-缺点"></a> 2.11.3 缺点</h4>
<p>比if语句读起来累，特别是一个表达式很长的时候。</p>
<h4 id="2114-推荐"><a class="markdownIt-Anchor" href="#2114-推荐"></a> 2.11.4 推荐</h4>
<p>适用于简单的，一行能解决的情况。在需要多行语句才能解决的情况，推荐使用完整的if语句。</p>
<h3 id="212-默认参数值default-argument-values"><a class="markdownIt-Anchor" href="#212-默认参数值default-argument-values"></a> 2.12 默认参数值(Default Argument Values)</h3>
<p>适用于大部分情况。</p>
<h4 id="2121-解释"><a class="markdownIt-Anchor" href="#2121-解释"></a> 2.12.1 解释</h4>
<p>函数的参数可以指定默认值。如<code>def foo(a, b=0):</code>。如果<code>foo</code>只传入一个参数，那么b的值就是0。如果传入两个参数，b的值就是第二个参数的值。</p>
<h4 id="2122-优点"><a class="markdownIt-Anchor" href="#2122-优点"></a> 2.12.2 优点</h4>
<p>你经常会碰到一些使用大量默认值的函数， 但偶尔(比较少见)你想要覆盖这些默认值。默认参数值提供了一种简单的方法来完成这件事， 你不需要为这些罕见的例外定义大量函数。同时, Python也不支持重载方法和函数，默认参数是一种&quot;仿造&quot;重载行为的简单方式。</p>
<h4 id="2123-缺点"><a class="markdownIt-Anchor" href="#2123-缺点"></a> 2.12.3 缺点</h4>
<p>默认参数只在模块加载时求值一次，如果参数是列表或字典之类的可变类型, 这可能会导致问题。如果在函数内部对该可变对象进行修改(比如向列表追加项<code>l.append('sth')</code>)，默认参数的值就被修改了。</p>
<h4 id="2124-推荐"><a class="markdownIt-Anchor" href="#2124-推荐"></a> 2.12.4 推荐</h4>
<p>鼓励使用。不过有如下注意事项：</p>
<p>不要在函数或方法定义中使用可变对象作为默认值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Yes: <span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(a, b=None)</span>:</span></span><br><span class="line">         <span class="keyword">if</span> b <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">             b = []</span><br><span class="line">Yes: <span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(a, b: Optional[Sequence] = None)</span>:</span></span><br><span class="line">         <span class="keyword">if</span> b <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">             b = []</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">No:  <span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(a, b=[])</span>:</span></span><br><span class="line">         ...</span><br><span class="line">No:  <span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(a, b=time.time<span class="params">()</span>)</span>:</span>  <span class="comment"># The time the module was loaded???</span></span><br><span class="line">         ...</span><br><span class="line">No:  <span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(a, b=FLAGS.my_thing)</span>:</span>  <span class="comment"># sys.argv has not yet been parsed...</span></span><br><span class="line">         ...</span><br></pre></td></tr></table></figure>
<h3 id="213-属性properties"><a class="markdownIt-Anchor" href="#213-属性properties"></a> 2.13 属性(Properties)</h3>
<p>访问和设置数据成员时， 你通常会使用简单，轻量级的访问和设置函数。建议用属性(properties)来代替它们。</p>
<h4 id="2131-解释"><a class="markdownIt-Anchor" href="#2131-解释"></a> 2.13.1 解释</h4>
<p>能够包装getter和setter。 当运算量不大, 它是获取和设置属性(attribute)的标准方式.</p>
<h4 id="2132-优点"><a class="markdownIt-Anchor" href="#2132-优点"></a> 2.13.2 优点</h4>
<p>指定显式的属性get和set方法可以提高可读性。允许延迟计算(lazy calculation)。不需要对类的接口进行改动。</p>
<h4 id="2133-缺点"><a class="markdownIt-Anchor" href="#2133-缺点"></a> 2.13.3 缺点</h4>
<p>在实例属性需要频繁访问的时候， 通过直接访问属性的速度会是通过该方式访问属性的3倍。在高性能编程下需要注意<code>@property</code>可能带来的性能问题。</p>
<h4 id="2134-推荐"><a class="markdownIt-Anchor" href="#2134-推荐"></a> 2.13.4 推荐</h4>
<p>推荐使用<code>@property</code>装饰器的方式来获取或者设置属性，在获取属性需要通过简单的计算表达式得出结果时，这是非常适合的。比如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Yes:</span><br><span class="line"><span class="meta">@property</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">area</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> math.pi * self.radius**<span class="number">2</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">Yes: </span><br><span class="line">     <span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line">     <span class="class"><span class="keyword">class</span> <span class="title">Square</span><span class="params">(object)</span>:</span></span><br><span class="line">         <span class="string">"""A square with two properties: a writable area and a read-only perimeter.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">         To use:</span></span><br><span class="line"><span class="string">         &gt;&gt;&gt; sq = Square(3)</span></span><br><span class="line"><span class="string">         &gt;&gt;&gt; sq.area</span></span><br><span class="line"><span class="string">         9</span></span><br><span class="line"><span class="string">         &gt;&gt;&gt; sq.perimeter</span></span><br><span class="line"><span class="string">         12</span></span><br><span class="line"><span class="string">         &gt;&gt;&gt; sq.area = 16</span></span><br><span class="line"><span class="string">         &gt;&gt;&gt; sq.side</span></span><br><span class="line"><span class="string">         4</span></span><br><span class="line"><span class="string">         &gt;&gt;&gt; sq.perimeter</span></span><br><span class="line"><span class="string">         16</span></span><br><span class="line"><span class="string">         """</span></span><br><span class="line"></span><br><span class="line">         <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, side)</span>:</span></span><br><span class="line">             self.side = side</span><br><span class="line"></span><br><span class="line"><span class="meta">         @property</span></span><br><span class="line">         <span class="function"><span class="keyword">def</span> <span class="title">area</span><span class="params">(self)</span>:</span></span><br><span class="line">             <span class="string">"""Gets or sets the area of the square."""</span></span><br><span class="line">             <span class="keyword">return</span> self._get_area()</span><br><span class="line"></span><br><span class="line"><span class="meta">         @area.setter</span></span><br><span class="line">         <span class="function"><span class="keyword">def</span> <span class="title">area</span><span class="params">(self, area)</span>:</span></span><br><span class="line">             <span class="keyword">return</span> self._set_area(area)</span><br><span class="line"></span><br><span class="line">         <span class="function"><span class="keyword">def</span> <span class="title">_get_area</span><span class="params">(self)</span>:</span></span><br><span class="line">             <span class="string">"""Indirect accessor to calculate the 'area' property."""</span></span><br><span class="line">             <span class="keyword">return</span> self.side ** <span class="number">2</span></span><br><span class="line"></span><br><span class="line">         <span class="function"><span class="keyword">def</span> <span class="title">_set_area</span><span class="params">(self, area)</span>:</span></span><br><span class="line">             <span class="string">"""Indirect setter to set the 'area' property."""</span></span><br><span class="line">             self.side = math.sqrt(area)</span><br><span class="line"></span><br><span class="line"><span class="meta">         @property</span></span><br><span class="line">         <span class="function"><span class="keyword">def</span> <span class="title">perimeter</span><span class="params">(self)</span>:</span></span><br><span class="line">             <span class="keyword">return</span> self.side * <span class="number">4</span></span><br></pre></td></tr></table></figure>
<p>避免太过简单的包装。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">No:</span><br><span class="line"><span class="meta">     @property</span></span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">area</span><span class="params">(self)</span>:</span></span><br><span class="line">     <span class="string">"""Gets or sets the area of the square."""</span></span><br><span class="line">         <span class="keyword">return</span> self._area</span><br></pre></td></tr></table></figure>
<p>避免通过<code>property</code>的方式设置getter和setter。使用<code>@property</code>和<code>@sth.setter</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">No:</span><br><span class="line">area = property(___get_area, ___set_area,</span><br><span class="line">                         doc=<span class="string">"""Gets or sets the area of the square."""</span>)</span><br></pre></td></tr></table></figure>
<h3 id="214-truefalse的求值truefalse-evaluations"><a class="markdownIt-Anchor" href="#214-truefalse的求值truefalse-evaluations"></a> 2.14 True/False的求值(True/False evaluations)</h3>
<p>尽可能使用隐式false</p>
<h4 id="2141-解释"><a class="markdownIt-Anchor" href="#2141-解释"></a> 2.14.1 解释</h4>
<p>Python在布尔上下文中会将某些值求值为<code>False</code>。 按简单的直觉来讲， 就是所有的&quot;空&quot;值都被认为是false。因此 <code>0, None, [], {}, &quot;&quot;</code>都被认为是false值。</p>
<h4 id="2142-优点"><a class="markdownIt-Anchor" href="#2142-优点"></a> 2.14.2 优点</h4>
<p>使用Pythonic布尔值的条件语句更易读也更不易犯错。</p>
<h4 id="2143-缺点"><a class="markdownIt-Anchor" href="#2143-缺点"></a> 2.14.3 缺点</h4>
<p>对于C/C++等其它语言开发人员来说，会感觉有点奇怪。</p>
<h4 id="2144-推荐"><a class="markdownIt-Anchor" href="#2144-推荐"></a> 2.14.4 推荐</h4>
<p>尽可能使用隐式的false， 例如: 使用 <code>if foo:</code> 而不是 <code>if foo != []:</code> . 不过还是有一些注意事项需要你铭记在心:</p>
<ul>
<li>永远不要用==或者!=来比较某些单例， 比如None。 使用<code>is</code>或者is not。</li>
<li>注意: 当你写下 <code>if x:</code> 时， 如果你其实表示的是 <code>if x is not None</code>，那么<code>if x:</code>是不对的。 例如: 当你要测试一个默认值是None的变量或参数是否被设为其它值。 这个值在布尔语义下可能是false！</li>
<li>永远不要用==将一个布尔量与false相比较. 使用 <code>if not x:</code> 代替. 如果你需要区分false和None, 你应该用像 <code>if not x and x is not None:</code> 这样的语句。</li>
<li>对于序列(字符串, 列表, 元组), 要注意空序列是false。因此 <code>if not seq:</code> 或者 <code>if seq:</code> 比 <code>if len(seq):</code> 或 <code>if not len(seq):</code> 要更好。</li>
<li>处理整数时, 使用隐式false可能会得不偿失(即不小心将None当做0来处理). 你可以将一个已知是整型(且不是len()的返回结果)的值与0比较。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Yes: <span class="keyword">if</span> <span class="keyword">not</span> users:</span><br><span class="line">         print(<span class="string">'no users'</span>)</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> foo == <span class="number">0</span>:</span><br><span class="line">         self.handle_zero()</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> i % <span class="number">10</span> == <span class="number">0</span>:</span><br><span class="line">         self.handle_multiple_of_ten()</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x=None)</span>:</span></span><br><span class="line">         <span class="keyword">if</span> x <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">             x = []</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">No:  <span class="keyword">if</span> len(users) == <span class="number">0</span>:</span><br><span class="line">         print(<span class="string">'no users'</span>)</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> foo <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span> <span class="keyword">and</span> <span class="keyword">not</span> foo:</span><br><span class="line">         self.handle_zero()</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> <span class="keyword">not</span> i % <span class="number">10</span>:</span><br><span class="line">         self.handle_multiple_of_ten()</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x=None)</span>:</span></span><br><span class="line">         x = x <span class="keyword">or</span> []</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>注意’0’(字符串)会被当做true。</p>
<p>​</p>
</li>
</ul>
<h3 id="215-过时的语言特性deprecated-language-features"><a class="markdownIt-Anchor" href="#215-过时的语言特性deprecated-language-features"></a> 2.15 过时的语言特性(Deprecated Language Features)</h3>
<p>使用字符串方法代替字符串模块。使用列表推导式和<code>for</code>循环代替<code>filter</code>。在<code>map</code> 中少用复杂的lambda函数。使用<code>for</code>循环而不是<code>reduce</code>。</p>
<h4 id="2151-解释"><a class="markdownIt-Anchor" href="#2151-解释"></a> 2.15.1 解释</h4>
<p>当前版本的Python提供了大家更喜欢的特性。</p>
<h4 id="2152-推荐"><a class="markdownIt-Anchor" href="#2152-推荐"></a> 2.15.2 推荐</h4>
<p>我们不使用陈旧的Python版本，而是尽可能使用新的和稳定的Python版本。所以我们应该尝试、习惯并探索更好的特性。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Yes: words = foo.split(<span class="string">':'</span>)</span><br><span class="line"></span><br><span class="line">     [x[<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> my_list <span class="keyword">if</span> x[<span class="number">2</span>] == <span class="number">5</span>]</span><br><span class="line"></span><br><span class="line">     map(math.sqrt, data)    <span class="comment"># Ok. No inlined lambda expression.</span></span><br><span class="line"></span><br><span class="line">     fn(*args, **kwargs)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">No:  words = string.split(foo, <span class="string">':'</span>)</span><br><span class="line"></span><br><span class="line">     map(<span class="keyword">lambda</span> x: x[<span class="number">1</span>], filter(<span class="keyword">lambda</span> x: x[<span class="number">2</span>] == <span class="number">5</span>, my_list))</span><br><span class="line"></span><br><span class="line">     apply(fn, args, kwargs)</span><br></pre></td></tr></table></figure>
<h3 id="216-变量作用域lexical-scoping"><a class="markdownIt-Anchor" href="#216-变量作用域lexical-scoping"></a> 2.16 变量作用域(Lexical Scoping)</h3>
<p>不要使用会让人误解的局部变量和全局变量，不同的变量作用域不同。</p>
<h4 id="2161-解释"><a class="markdownIt-Anchor" href="#2161-解释"></a> 2.16.1 解释</h4>
<p>嵌套的Python函数可以引用外层函数中定义的变量，但是不能够对它们赋值。变量绑定的解析是使用词法作用域, 也就是基于静态的程序文本。对一个块中的某个名称的任何赋值都会导致Python将对该名称的全部引用当做局部变量， 甚至是赋值前的处理。 如果碰到global声明，该变量就会被视作全局变量。</p>
<p>一个使用闭包的例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_adder</span><span class="params">(summand1)</span>:</span></span><br><span class="line">    <span class="string">"""Returns a function that adds numbers to a given number."""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">adder</span><span class="params">(summand2)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> summand1 + summand2</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> adder</span><br></pre></td></tr></table></figure>
<p>调用方式<code>sum = get_adder(summand1)(summand2)</code></p>
<h4 id="2162-优点"><a class="markdownIt-Anchor" href="#2162-优点"></a> 2.16.2 优点</h4>
<p>结果更加清晰，对Lisp和Scheme(Haskell，ML等)程序员友好</p>
<h4 id="2163-缺点"><a class="markdownIt-Anchor" href="#2163-缺点"></a> 2.16.3 缺点</h4>
<p>可能会产生令人费解的bug。</p>
<p>例如这个依据 <a href="http://www.python.org/dev/peps/pep-0227/" target="_blank" rel="noopener">PEP 0227</a> 的例子:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">4</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">()</span>:</span></span><br><span class="line">        print(i, end=<span class="string">''</span>)</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="comment"># A bunch of code here</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> x:  <span class="comment"># Ah, i *is* local to foo, so this is what bar sees</span></span><br><span class="line">        print(i, end=<span class="string">''</span>)</span><br><span class="line">    bar()</span><br></pre></td></tr></table></figure>
<p>因此 <code>foo([1, 2, 3])</code> 会打印 <code>1 2 3 3</code> ，不是 <code>1 2 3 4</code> 。</p>
<p>因为foo函数中的i被隐式赋值为3， 而不是使用全局的4。</p>
<h4 id="2164-推荐"><a class="markdownIt-Anchor" href="#2164-推荐"></a> 2.16.4 推荐</h4>
<p><strong>非常熟悉该特性的开发者可以使用。否则慎用。</strong></p>
<p>闭包会有一些问题比如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">No:</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count</span><span class="params">()</span>:</span></span><br><span class="line">    fs = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">4</span>):</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">()</span>:</span></span><br><span class="line">             <span class="keyword">return</span> i*i</span><br><span class="line">        fs.append(f)</span><br><span class="line">    <span class="keyword">return</span> fs</span><br><span class="line"></span><br><span class="line">f1, f2, f3 = count()</span><br></pre></td></tr></table></figure>
<p>你可能认为调用<code>f1()</code>，<code>f2()</code>和<code>f3()</code>结果应该是<code>1</code>，<code>4</code>，<code>9</code>，但实际结果是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f1()</span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f2()</span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f3()</span><br><span class="line"><span class="number">9</span></span><br></pre></td></tr></table></figure>
<p>解释：返回函数引用变量<code>i</code>，但是它并不是立即执行的，而是延迟执行。等到3个函数都返回时，它们所引用的变量<code>i</code>已经变成了<code>3</code>，因此最终结果为<code>9</code>。</p>
<p>如果一定要引用循环变量怎么办？方法是再创建一个函数立即执行，用该函数的参数绑定循环变量当前的值，无论该循环变量后续如何更改，已绑定到函数参数的值不变：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Yes:</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(j)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">g</span><span class="params">()</span>:</span></span><br><span class="line">            <span class="keyword">return</span> j*j</span><br><span class="line">        <span class="keyword">return</span> g</span><br><span class="line">    fs = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">4</span>):</span><br><span class="line">        fs.append(f(i)) <span class="comment"># f(i)立刻被执行，因此i的当前值被传入f()</span></span><br><span class="line">    <span class="keyword">return</span> fs</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f1, f2, f3 = count()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f1()</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f2()</span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f3()</span><br><span class="line"><span class="number">9</span></span><br></pre></td></tr></table></figure>
<p><code>返回闭包时牢记：返回函数不要引用任何循环变量，或者后续会发生变化的变量。</code></p>
<h3 id="217-函数和方法装饰器function-and-method-decorators"><a class="markdownIt-Anchor" href="#217-函数和方法装饰器function-and-method-decorators"></a> 2.17 函数和方法装饰器(Function and Method Decorators)</h3>
<p>使用装饰器。避免使用<code>@staticmethod</code>以及限制使用<code>@classmethod</code></p>
<h4 id="2171-解释"><a class="markdownIt-Anchor" href="#2171-解释"></a> 2.17.1 解释</h4>
<p><a href="https://docs.python.org/release/2.4.3/whatsnew/node6.html" target="_blank" rel="noopener">用于函数及方法的装饰器</a> (也就是@标记)。一个流行的装饰器是<code>@property</code>用于把普通的方法转化成属性。装饰器也允许由用户自定义。比如<code>my_decorator</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>:</span></span><br><span class="line"><span class="meta">    @my_decorator</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">method</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># method body ...</span></span><br></pre></td></tr></table></figure>
<p>等同于</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class C:</span><br><span class="line">    def Methodmethod(self):</span><br><span class="line">        # method body ...</span><br><span class="line">    Methodmethod = MyDecoratormy_decorator(Methodmethod)</span><br></pre></td></tr></table></figure>
<h4 id="2172-优点"><a class="markdownIt-Anchor" href="#2172-优点"></a> 2.17.2 优点</h4>
<p>优雅地定义了，减少重复的代码，从纵向上减少代码的耦合程度。具有面向切面编程的优点。</p>
<h4 id="2173-缺点"><a class="markdownIt-Anchor" href="#2173-缺点"></a> 2.17.3 缺点</h4>
<p>装饰器会修改函数的参数或者返回值，这些操作都是隐式的。另外装饰器在导入时(import time)与函数绑定生效。装饰器中产生的错误会更加难追查。</p>
<h4 id="2174-推荐"><a class="markdownIt-Anchor" href="#2174-推荐"></a> 2.17.4 推荐</h4>
<p>如果有非常明显的优点(代码复用，面向切面编程)，那么就可以使用它。装饰器需要遵守和函数一样的导入和命名规则。装饰器的文档需要说明这是一个装饰器。为装饰器编写健壮的单元测试。</p>
<p>避免装饰器对外部的依赖(比如不要依赖文件，socket，数据库连接等)。要保证装饰器的有效调用在任何情况下都是成功的。</p>
<p>装饰器是一种特殊的“顶层代码”(top level code)。</p>
<p>少用<code>@staticmethod</code>。大多数情况下，直接使用模块级的函数更加适合而不是跟类耦合在一起。少部分情况下，在函数只被该类使用的情况下，可以使用<code>@staticmethod</code>。</p>
<p>仅在写构造函数时使用<code>@classmethod</code>。如果要修改类变量的值，也需要使用<code>@classmethod</code>。</p>
<h3 id="218-线程threading"><a class="markdownIt-Anchor" href="#218-线程threading"></a> 2.18 线程(Threading)</h3>
<p>不要依赖内建类型(<code>built-in</code>)的原子性。</p>
<h4 id="2181-推荐"><a class="markdownIt-Anchor" href="#2181-推荐"></a> 2.18.1 推荐</h4>
<p>虽然Python的内建类型比如字典的操作看上去都是原子的，但是在某些情况下它们仍然不是原子的(如果<code>__hash__</code>或<code>__eq__</code>以Python代码实现)，因此他们的原子性是不可靠的。</p>
<p>使用<code>Queue</code>作为线程间的数据通信方式。其它情况，使用<code>threading</code>模块和锁原语(locking primitives)。学习<code>condition</code>的适用场景，你可以使用<code>threading.Condition</code>来取代低级别的<code>Lock</code>。</p>
<h3 id="219-强大的特性power-features"><a class="markdownIt-Anchor" href="#219-强大的特性power-features"></a> 2.19 强大的特性(Power Features)</h3>
<p>强大不等于好用， 相反强大的特性正式因为它能做的事情过于强大，容易让初中级程序员翻船。</p>
<h4 id="2191-解释"><a class="markdownIt-Anchor" href="#2191-解释"></a> 2.19.1 解释</h4>
<p>Python是非常灵活的语言， 它为你提供了很多花哨的特性，诸如元类(metaclasses)，字节码(bytecode)访问, 任意编译(on-the-fly compilation)，动态继承(dynamic inheritance)，对象父类重定义(object reparenting)，导入黑客(import hacks), 反射，系统内修改(modification of system internals)等等。</p>
<h4 id="2192-优点"><a class="markdownIt-Anchor" href="#2192-优点"></a> 2.19.2 优点</h4>
<p>强大的语言特性，可以让你的代码更加简洁紧凑。</p>
<h4 id="2193-缺点"><a class="markdownIt-Anchor" href="#2193-缺点"></a> 2.19.3 缺点</h4>
<p>奇淫技巧的代码会变得难以阅读和调试。刚开始写下这些代码时还能理解，但是当后续回顾这些代码时，理解起来还不如一些虽然写得比较长还是表达意思很直接的代码。</p>
<h4 id="2194-推荐"><a class="markdownIt-Anchor" href="#2194-推荐"></a> 2.19.4 推荐</h4>
<p>除非你对你将要使用的特性理解非常深入(你能够理解为什么要这么做，以及懂得怎么正确地去做)， 否则不要使用这些奇淫技巧。</p>
<p>有些特性经过封装后，我们认为它是相对安全并且容易理解的。</p>
<p>部分使用了这些特性的标准库的模块和类是允许使用的(比如<code>abc.ABCMeta</code>，<code>collections.namedtuple</code>和<code>enum</code>)。</p>
<h3 id="220-现代化pythonmodern-python-python-3-and-from-_future_-imports"><a class="markdownIt-Anchor" href="#220-现代化pythonmodern-python-python-3-and-from-_future_-imports"></a> 2.20 现代化Python(Modern Python: Python 3 and from _<em>future</em>_ imports)</h3>
<p>Python3即将开启新的时代！ 但是某些项目还不支持Python3， 因此那些项目需要进行迁移或是兼容。</p>
<h4 id="2201-解释"><a class="markdownIt-Anchor" href="#2201-解释"></a> 2.20.1 解释</h4>
<p>Python3是Python的一个重要的改变。但是Python2的代码仍然存在，这时候需要利用future模块来进行兼容，而不需要做太大的改动。</p>
<h4 id="2202-优点"><a class="markdownIt-Anchor" href="#2202-优点"></a> 2.20.2 优点</h4>
<p>Python3的语法更加优雅。</p>
<h4 id="2203-缺点"><a class="markdownIt-Anchor" href="#2203-缺点"></a> 2.20.3 缺点</h4>
<p>future模块可能有些丑。没错，毕竟future是为了兼容所做的妥协。</p>
<h4 id="2204-推荐"><a class="markdownIt-Anchor" href="#2204-推荐"></a> 2.20.4 推荐</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> absolute_import</span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br></pre></td></tr></table></figure>
<p>如果你对这些兼容为什么要这么做不太了解，你可以阅读 <a href="https://www.python.org/dev/peps/pep-0328/" target="_blank" rel="noopener">absolute imports</a>, <a href="https://www.python.org/dev/peps/pep-0238/" target="_blank" rel="noopener">new <code>/</code> division behavior</a>, and <a href="https://www.python.org/dev/peps/pep-3105/" target="_blank" rel="noopener">the print function</a>。</p>
<p>future, six模块可以帮助你进行Python2和3的兼容。</p>
<p>如果没有兼容Python2的必要，请选择Python3.5+的版本进行编程。</p>
<p>仔细阅读<a href="https://docs.python.org/3/howto/pyporting.html" target="_blank" rel="noopener">Python2到3迁移</a>，并对自己的项目进行改造。😄</p>
<p>在100%的情况下不建议再使用Python2进行编程。</p>
<h3 id="221-代码类型注释type-annotated-code"><a class="markdownIt-Anchor" href="#221-代码类型注释type-annotated-code"></a> 2.21 代码类型注释(Type Annotated Code)</h3>
<p>非常好的特性， 你可以对Python3.5+的代码进行注释，参考 <a href="https://www.python.org/dev/peps/pep-0484/" target="_blank" rel="noopener">PEP-484</a>。从python3.6开始还增加了变量注释，参考<a href="https://www.python.org/dev/peps/pep-0526/" target="_blank" rel="noopener">PEP-0526</a>。</p>
<h4 id="2211-解释"><a class="markdownIt-Anchor" href="#2211-解释"></a> 2.21.1 解释</h4>
<p>类型注释<code>type annotations</code>(或者说类型提示<code>type hints</code>)是对函数参数和返回值进行注释。</p>
<p>类型注释：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(a: int)</span> -&gt; List[int]:</span></span><br></pre></td></tr></table></figure>
<p>变量注释：</p>
<p><code>some_number: int</code></p>
<p><code>valuesome_list: List[int] = []</code></p>
<h4 id="2212-优点"><a class="markdownIt-Anchor" href="#2212-优点"></a> 2.21.2 优点</h4>
<p>类型注释提高了你代码的可读性和可维护性。类型检查器可以根据类型注释把可能在运行时发生的错误提前检查出来。提高了项目的工程强度。</p>
<h4 id="2213-缺点"><a class="markdownIt-Anchor" href="#2213-缺点"></a> 2.21.3 缺点</h4>
<ul>
<li>Python3.5+支持。你需要不停更新这些类型声明。但是这会让你对你的代码非常熟悉，其实也算是一个优点。</li>
<li>可能会限制开发者使用一些Python奇淫技巧的能力。</li>
</ul>
<h4 id="2214-推荐"><a class="markdownIt-Anchor" href="#2214-推荐"></a> 2.21.4 推荐</h4>
<p>如果你的项目复杂到你必须进行类型注释，那么这一定是一个值得一试的特性。</p>
<p>把代码变成类似静态语言的风格并不是在开倒车，在一个大型项目下这是必须要做的事情。</p>
<h2 id="3-python风格规范"><a class="markdownIt-Anchor" href="#3-python风格规范"></a> 3 Python风格规范</h2>
<h3 id="31-代码格式化工具"><a class="markdownIt-Anchor" href="#31-代码格式化工具"></a> 3.1 代码格式化工具</h3>
<p>使用代码格式化插件格式化代码。</p>
<p><strong>Pycharm</strong></p>
<p>使用Cmd + Option + L（Windows：Control+Alt+L）快捷键进行格式化。</p>
<p><strong>Visual Studio Code</strong></p>
<p>通过pip安装flake8和yapf<br>
安装VSCode的Python扩展<br>
使用Option+Shift+F（Windows：Alt+Shift+F）</p>
<h3 id="32-分号semicolons"><a class="markdownIt-Anchor" href="#32-分号semicolons"></a> 3.2 分号(Semicolons)</h3>
<p>不要在行尾添加分号，也不要用分号将两条命令放在同一行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Yes:</span><br><span class="line"><span class="keyword">import</span> a</span><br><span class="line"><span class="keyword">import</span> b</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">No:</span><br><span class="line"><span class="keyword">import</span> a;<span class="keyword">import</span> b;</span><br></pre></td></tr></table></figure>
<h3 id="33-行长度line-length"><a class="markdownIt-Anchor" href="#33-行长度line-length"></a> 3.3 行长度(Line length)</h3>
<p>每行不超过120个字符。</p>
<p>例外：</p>
<ul>
<li>很长的导入语句。</li>
<li>URL，路径名，或者注释中非常长的flag。</li>
</ul>
<p>不要使用反斜杠换行。</p>
<p>Python会把<code>(),[],{}</code>中的行自动隐式地连接到一起， 可以利用这个特性连接行。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Yes: foo_bar(self, width, height, color=<span class="string">'black'</span>, design=<span class="keyword">None</span>, x=<span class="string">'foo'</span>,</span><br><span class="line">             emphasis=<span class="keyword">None</span>, highlight=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (width == <span class="number">0</span> <span class="keyword">and</span> height == <span class="number">0</span> <span class="keyword">and</span></span><br><span class="line">         color == <span class="string">'red'</span> <span class="keyword">and</span> emphasis == <span class="string">'strong'</span>):</span><br></pre></td></tr></table></figure>
<p>如果一个字符串在一行放不下， 使用圆括号来进行隐式的连接：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x = (<span class="string">'This will build a very long long '</span></span><br><span class="line">     <span class="string">'long long long long long long string'</span>)</span><br></pre></td></tr></table></figure>
<p>在注释中，可以把长的URL放在一行上。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Yes:  <span class="comment"># See details at</span></span><br><span class="line">      <span class="comment"># http://www.example.com/us/developer/documentation/api/content/v2.0/csv_file_name_extension_full_specification.html</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">No:  # See details at</span><br><span class="line">     # http://www.example.com/us/developer/documentation/api/content/\</span><br><span class="line">     # v2.0/csv_file_name_extension_full_specification.html</span><br></pre></td></tr></table></figure>
<p>在使用<code>with</code>语句时， 三个以上的表达式可以被反斜杠分为多行。对于两行表达式，使用嵌套<code>with</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Yes:  <span class="keyword">with</span> very_long_first_expression_function() <span class="keyword">as</span> spam, \</span><br><span class="line">           very_long_second_expression_function() <span class="keyword">as</span> beans, \</span><br><span class="line">           third_thing() <span class="keyword">as</span> eggs:</span><br><span class="line">          place_order(eggs, beans, spam, beans)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">No:  <span class="keyword">with</span> VeryLongFirstExpressionFunction() <span class="keyword">as</span> spam, \</span><br><span class="line">          VeryLongSecondExpressionFunction() <span class="keyword">as</span> beans:</span><br><span class="line">       PlaceOrder(eggs, beans, spam, beans)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Yes:  <span class="keyword">with</span> very_long_first_expression_function() <span class="keyword">as</span> spam:</span><br><span class="line">          <span class="keyword">with</span> very_long_second_expression_function() <span class="keyword">as</span> beans:</span><br><span class="line">              place_order(beans, spam)</span><br></pre></td></tr></table></figure>
<h3 id="34-括号parentheses"><a class="markdownIt-Anchor" href="#34-括号parentheses"></a> 3.4 括号(Parentheses)</h3>
<p>少用括号。</p>
<p>除非是为了实现行与行之间的连接，否则不要在返回语句或条件语句中使用括号。在元祖两边使用括号是必要的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Yes: <span class="keyword">if</span> foo:</span><br><span class="line">         bar()</span><br><span class="line">     <span class="keyword">while</span> x:</span><br><span class="line">         x = bar()</span><br><span class="line">     <span class="keyword">if</span> x <span class="keyword">and</span> y:</span><br><span class="line">         bar()</span><br><span class="line">     <span class="keyword">if</span> <span class="keyword">not</span> x:</span><br><span class="line">         bar()</span><br><span class="line">     <span class="comment"># 对于只包含一项的元祖，比起onesie = foo来说, 加上括号更加明显</span></span><br><span class="line">     onesie = (foo,)</span><br><span class="line">     <span class="keyword">return</span> foo</span><br><span class="line">     <span class="keyword">return</span> spam, beans</span><br><span class="line">     <span class="keyword">return</span> (spam, beans)</span><br><span class="line">     <span class="keyword">for</span> (x, y) <span class="keyword">in</span> dict.items(): ...</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">No:  <span class="keyword">if</span> (x):</span><br><span class="line">         bar()</span><br><span class="line">     <span class="keyword">if</span> <span class="keyword">not</span>(x):</span><br><span class="line">         bar()</span><br><span class="line">     <span class="keyword">return</span> (foo)</span><br></pre></td></tr></table></figure>
<h3 id="35-缩进indentation"><a class="markdownIt-Anchor" href="#35-缩进indentation"></a> 3.5 缩进(Indentation)</h3>
<p>使用4个空格缩进代码。</p>
<p>不要使用tab！对于行链接的情况，使用垂直对齐：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Yes:   <span class="comment"># Aligned with opening delimiter</span></span><br><span class="line">       foo = long_function_name(var_one, var_two,</span><br><span class="line">                                var_three, var_four)</span><br><span class="line">       meal = (spam,</span><br><span class="line">               beans)</span><br><span class="line"></span><br><span class="line">       <span class="comment"># Aligned with opening delimiter in a dictionary</span></span><br><span class="line">       foo = &#123;</span><br><span class="line">           long_dictionary_key: value1 +</span><br><span class="line">                                value2,</span><br><span class="line">           ...</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment"># 4-space hanging indent; nothing on first line</span></span><br><span class="line">       foo = long_function_name(</span><br><span class="line">           var_one, var_two, var_three,</span><br><span class="line">           var_four)</span><br><span class="line">       meal = (</span><br><span class="line">           spam,</span><br><span class="line">           beans)</span><br><span class="line"></span><br><span class="line">       <span class="comment"># 4-space hanging indent in a dictionary</span></span><br><span class="line">       foo = &#123;</span><br><span class="line">           long_dictionary_key:</span><br><span class="line">               long_dictionary_value,</span><br><span class="line">           ...</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">No:    <span class="comment"># Stuff on first line forbidden</span></span><br><span class="line">       foo = long_function_name(var_one, var_two,</span><br><span class="line">           var_three, var_four)</span><br><span class="line">       meal = (spam,</span><br><span class="line">           beans)</span><br><span class="line"></span><br><span class="line">       <span class="comment"># 2-space hanging indent forbidden</span></span><br><span class="line">       foo = long_function_name(</span><br><span class="line">         var_one, var_two, var_three,</span><br><span class="line">         var_four)</span><br><span class="line"></span><br><span class="line">       <span class="comment"># No hanging indent in a dictionary</span></span><br><span class="line">       foo = &#123;</span><br><span class="line">           long_dictionary_key:</span><br><span class="line">           long_dictionary_value,</span><br><span class="line">           ...</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<h3 id="36-空行blank-lines"><a class="markdownIt-Anchor" href="#36-空行blank-lines"></a> 3.6 空行(Blank Lines)</h3>
<p>顶层的定义之间空两行， 方法定义之间空一行。</p>
<p>顶层定义之间空两行, 比如函数或者类定义。方法定义，类定义与第一个方法之间，都应该空一行。函数或方法中, 某些地方要是你觉得合适, 就空一行。</p>
<h3 id="37-空格whitespace"><a class="markdownIt-Anchor" href="#37-空格whitespace"></a> 3.7 空格(Whitespace)</h3>
<p>按照标准的排版规范使用标点两边的空格。</p>
<p>括号内不要有空格。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Yes: spam(ham[<span class="number">1</span>], &#123;eggs: <span class="number">2</span>&#125;, [])</span><br><span class="line">No:  spam( ham[ <span class="number">1</span> ], &#123; eggs: <span class="number">2</span> &#125;, [ ] )</span><br></pre></td></tr></table></figure>
<p>不要在逗号，分号，冒号前面加空格，在他们后面加。行尾不用加空格。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Yes: <span class="keyword">if</span> x == <span class="number">4</span>:</span><br><span class="line">         print(x, y)</span><br><span class="line">     x, y = y, x</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">No:  <span class="keyword">if</span> x == <span class="number">4</span> :</span><br><span class="line">         print(x , y)</span><br><span class="line">     x , y = y , x</span><br></pre></td></tr></table></figure>
<p>参数列表，索引或切片的左括号前不应该加空格。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Yes: spam(<span class="number">1</span>)</span><br><span class="line">No:  spam (<span class="number">1</span>)</span><br><span class="line">Yes: dict[<span class="string">'key'</span>] = list[index]</span><br><span class="line">No:  dict [<span class="string">'key'</span>] = list [index]</span><br></pre></td></tr></table></figure>
<p>在切片中，应该添加适当的空格。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Yes:</span><br><span class="line">ham[<span class="number">1</span>:<span class="number">9</span>], ham[<span class="number">1</span>:<span class="number">9</span>:<span class="number">3</span>], ham[:<span class="number">9</span>:<span class="number">3</span>], ham[<span class="number">1</span>::<span class="number">3</span>], ham[<span class="number">1</span>:<span class="number">9</span>:]</span><br><span class="line">ham[lower:upper], ham[lower:upper:], ham[lower::step]</span><br><span class="line">ham[lower+offset : upper+offset]</span><br><span class="line">ham[: upper_fn(x) : step_fn(x)], ham[:: step_fn(x)]</span><br><span class="line">ham[lower + offset : upper + offset]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">No:</span><br><span class="line">ham[lower + offset:upper + offset]</span><br><span class="line">ham[<span class="number">1</span>: <span class="number">9</span>], ham[<span class="number">1</span> :<span class="number">9</span>], ham[<span class="number">1</span>:<span class="number">9</span> :<span class="number">3</span>]</span><br><span class="line">ham[lower : : upper]</span><br><span class="line">ham[ : upper]</span><br></pre></td></tr></table></figure>
<p>在二元操作符两边都加上一个空格, 比如赋值(<code>=</code>)， 比较(<code>==, &lt;, &gt;, !=, &lt;&gt;, &lt;=, &gt;=, in, not in, is, is not</code>), 布尔(<code>and, or, not</code>)。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Yes: x == <span class="number">1</span></span><br><span class="line">No:  x&lt;<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>当<code>=</code>用于指示关键字参数或默认参数值时，不要在其两侧使用空格。但是在进行类型注释的时候，允许使用空格。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Yes: <span class="function"><span class="keyword">def</span> <span class="title">complex</span><span class="params">(real, imag=<span class="number">0.0</span>)</span>:</span> <span class="keyword">return</span> Magic(r=real, i=imag)</span><br><span class="line">Yes: <span class="function"><span class="keyword">def</span> <span class="title">complex</span><span class="params">(real, imag: float = <span class="number">0.0</span>)</span>:</span> <span class="keyword">return</span> Magic(r=real, i=imag)</span><br><span class="line"></span><br><span class="line">No:  <span class="function"><span class="keyword">def</span> <span class="title">complex</span><span class="params">(real, imag = <span class="number">0.0</span>)</span>:</span> <span class="keyword">return</span> Magic(r = real, i = imag)</span><br><span class="line">No:  <span class="function"><span class="keyword">def</span> <span class="title">complex</span><span class="params">(real, imag: float=<span class="number">0.0</span>)</span>:</span> <span class="keyword">return</span> Magic(r = real, i = imag)</span><br></pre></td></tr></table></figure>
<p>不要用空格来垂直对齐多行间的标记, 因为这会成为维护的负担(适用于<code>:</code>，<code>#</code>，<code>=</code>等)，保持左对齐就可以：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Yes:</span><br><span class="line">  foo = <span class="number">1000</span>  <span class="comment"># comment</span></span><br><span class="line">  long_name = <span class="number">2</span>  <span class="comment"># comment that should not be aligned</span></span><br><span class="line"></span><br><span class="line">  dictionary = &#123;</span><br><span class="line">      <span class="string">'foo'</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="string">'long_name'</span>: <span class="number">2</span>,</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">No:</span><br><span class="line">  foo       = <span class="number">1000</span>  <span class="comment"># comment</span></span><br><span class="line">  long_name = <span class="number">2</span>     <span class="comment"># comment that should not be aligned</span></span><br><span class="line"></span><br><span class="line">  dictionary = &#123;</span><br><span class="line">      <span class="string">'foo'</span>      : <span class="number">1</span>,</span><br><span class="line">      <span class="string">'long_name'</span>: <span class="number">2</span>,</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="38-shebang行shebang-line"><a class="markdownIt-Anchor" href="#38-shebang行shebang-line"></a> 3.8 SheBang行(Shebang Line)</h3>
<p>在计算领域中，Shebang(也称为 Hashbang )是一个由井号和叹号构成的字符序列 #! ，其出现在文本文件的第一行的前两个字符。 在文件中存在 Shebang 的情况下，类 Unix 操作系统的程序载入器会分析 Shebang 后的内容，将这些内容作为解释器指令，并调用该指令，并将载有 Shebang 的文件路径作为该解释器的参数。</p>
<p>大部分.py文件不必以#!作为文件的开头。 根据 <a href="http://www.python.org/dev/peps/pep-0394/" target="_blank" rel="noopener">PEP-394</a> ，程序的main文件应该以 #!/usr/bin/python2或者 #!/usr/bin/python3开始。</p>
<h3 id="39-注释和文档字符串comments-and-docstrings"><a class="markdownIt-Anchor" href="#39-注释和文档字符串comments-and-docstrings"></a> 3.9 注释和文档字符串(Comments and Docstrings)</h3>
<p>确保正确使用模块、函数、方法的文档字符串和行内注释。</p>
<h4 id="391-文档字符串docstrings"><a class="markdownIt-Anchor" href="#391-文档字符串docstrings"></a> 3.9.1 文档字符串(Docstrings)</h4>
<blockquote>
<p>Python有一种独一无二的的注释方式：使用文档字符串。文档字符串是包，模块，类或函数里的第一个语句。这些字符串可以通过对象的__doc__成员被自动提取，并且被pydoc所用。 (你可以在你的模块上运行pydoc试一把， 看看它长什么样)。 我们对文档字符串的惯例是使用三重双引号&quot;&quot;&quot;( <a href="http://www.python.org/dev/peps/pep-0257/" target="_blank" rel="noopener">PEP-257</a> )。 一个文档字符串应该这样组织：首先是一行以句号，问号或感叹号结尾的概述(或者该文档字符串单纯只有一行)。接着是一个空行。接着是文档字符串剩下的部分，它应该与文档字符串的第一行的第一个引号对齐。下面有更多文档字符串的格式化规范。</p>
</blockquote>
<h4 id="392-模块modules"><a class="markdownIt-Anchor" href="#392-模块modules"></a> 3.9.2 模块(Modules)</h4>
<blockquote>
<p>每个文件应该包含一个许可证。根据项目使用的许可(例如：Apache 2.0，BSD，LGPL，GPL)，选择合适的许可证。</p>
</blockquote>
<h4 id="393-函数和方法functions-and-methods"><a class="markdownIt-Anchor" href="#393-函数和方法functions-and-methods"></a> 3.9.3 函数和方法(Functions and Methods)</h4>
<blockquote>
<p>下文所指的函数，包括函数、方法以及生成器。</p>
<p>一个函数必须要有文档字符串，除非它满足以下条件：</p>
<ol>
<li>外部不可见</li>
<li>非常短小</li>
<li>简单明了</li>
</ol>
<p>文档字符串应该包含函数做什么，以及输入和输出的详细描述。通常，不应该描述&quot;怎么做&quot;，除非是一些复杂的算法。文档字符串应该提供足够的信息，当别人编写代码调用该函数时，他不需要看一行代码，只要看文档字符串就可以了。对于复杂的代码，在代码旁边加注释会比使用文档字符串更有意义。</p>
<p>关于函数的几个方面应该在特定的小节中进行描述记录，这几个方面如下文所述。每节应该以一个标题行开始。标题行以冒号结尾。除标题行外，节的其他内容应被缩进2个空格。</p>
<ul>
<li>
<p>Args:</p>
<p>列出每个参数的名字并在名字后使用一个冒号和一个空格，分隔对该参数的描述。如果描述太长超过了单行120字符，使用2或者4个空格的悬挂缩进(与文件其他部分保持一致)。描述应该包括所需的类型和含义。如果一个函数接受<em>foo(可变长度参数列表)或者**bar (任意关键字参数), 应该详细列出</em>foo和**bar。</p>
</li>
<li>
<p>Returns: (或者 Yields: 用于生成器)</p>
<p>描述返回值的类型和语义。如果函数返回None，这一部分可以省略。</p>
</li>
<li>
<p>Raises:</p>
<p>列出与接口有关的所有异常。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&gt; def fetch_bigtable_rows(big_table, keys, other_silly_variable=None):</span><br><span class="line">&gt;     &quot;&quot;&quot;Fetches rows from a Bigtable.</span><br><span class="line">&gt; </span><br><span class="line">&gt;     Retrieves rows pertaining to the given keys from the Table instance</span><br><span class="line">&gt;     represented by big_table.  Silly things may happen if</span><br><span class="line">&gt;     other_silly_variable is not None.</span><br><span class="line">&gt; </span><br><span class="line">&gt;     Args:</span><br><span class="line">&gt;         big_table: An open Bigtable Table instance.</span><br><span class="line">&gt;         keys: A sequence of strings representing the key of each table row</span><br><span class="line">&gt;             to fetch.</span><br><span class="line">&gt;         other_silly_variable: Another optional variable, that has a much</span><br><span class="line">&gt;             longer name than the other args, and which does nothing.</span><br><span class="line">&gt; </span><br><span class="line">&gt;     Returns:</span><br><span class="line">&gt;         A dict mapping keys to the corresponding table row data</span><br><span class="line">&gt;         fetched. Each row is represented as a tuple of strings. For</span><br><span class="line">&gt;         example:</span><br><span class="line">&gt; </span><br><span class="line">&gt;         &#123;&apos;Serak&apos;: (&apos;Rigel VII&apos;, &apos;Preparer&apos;),</span><br><span class="line">&gt;          &apos;Zim&apos;: (&apos;Irk&apos;, &apos;Invader&apos;),</span><br><span class="line">&gt;          &apos;Lrrr&apos;: (&apos;Omicron Persei 8&apos;, &apos;Emperor&apos;)&#125;</span><br><span class="line">&gt; </span><br><span class="line">&gt;         If a key from the keys argument is missing from the dictionary,</span><br><span class="line">&gt;         then that row was not found in the table.</span><br><span class="line">&gt; </span><br><span class="line">&gt;     Raises:</span><br><span class="line">&gt;         IOError: An error occurred accessing the bigtable.Table object.</span><br><span class="line">&gt;     &quot;&quot;&quot;</span><br><span class="line">&gt;     pass</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="394-类classes"><a class="markdownIt-Anchor" href="#394-类classes"></a> 3.9.4 类(Classes)</h4>
<blockquote>
<p>类应该在其定义下有一个用于描述该类的文档字符串。如果你的类有公共属性(Attributes)，那么文档中应该有一个属性(Attributes)段。并且应该遵守和函数参数相同的格式。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt; class SampleClass(object):</span><br><span class="line">&gt;     &quot;&quot;&quot;Summary of class here.</span><br><span class="line">&gt; </span><br><span class="line">&gt;     Longer class information....</span><br><span class="line">&gt;     Longer class information....</span><br><span class="line">&gt; </span><br><span class="line">&gt;     Attributes:</span><br><span class="line">&gt;         likes_spam: A boolean indicating if we like SPAM or not.</span><br><span class="line">&gt;         eggs: An integer count of the eggs we have laid.</span><br><span class="line">&gt;     &quot;&quot;&quot;</span><br><span class="line">&gt; </span><br><span class="line">&gt;     def __init__(self, likes_spam=False):</span><br><span class="line">&gt;         &quot;&quot;&quot;Inits SampleClass with blah.&quot;&quot;&quot;</span><br><span class="line">&gt;         self.likes_spam = likes_spam</span><br><span class="line">&gt;         self.eggs = 0</span><br><span class="line">&gt; </span><br><span class="line">&gt;     def public_method(self):</span><br><span class="line">&gt;         &quot;&quot;&quot;Performs operation blah.&quot;&quot;&quot;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="395-块注释和行注释block-and-inline-comments"><a class="markdownIt-Anchor" href="#395-块注释和行注释block-and-inline-comments"></a> 3.9.5 块注释和行注释(Block and Inline Comments)</h4>
<blockquote>
<p>最需要写注释的是代码中那些技巧性的部分。如果你在下次 <a href="http://en.wikipedia.org/wiki/Code_review" target="_blank" rel="noopener">代码审查</a> 的时候必须解释一下，那么你应该现在就给它写注释。对于复杂的操作，应该在其操作开始前写上若干行注释。对于不是一目了然的代码，应在其行尾添加注释。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; # We use a weighted dictionary search to find out where i is in</span><br><span class="line">&gt; # the array.  We extrapolate position based on the largest num</span><br><span class="line">&gt; # in the array and the array size and then do binary search to</span><br><span class="line">&gt; # get the exact number.</span><br><span class="line">&gt; </span><br><span class="line">&gt; if i &amp; (i-1) == 0:        # true iff i is a power of 2</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>为了提高可读性，注释应该至少离开代码2个空格。</p>
<p>另一方面，绝不要描述代码。 假设阅读代码的人比你更懂Python， 他只是不知道你的代码要做什么。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; # BAD COMMENT: Now go through the b array and make sure whenever i occurs</span><br><span class="line">&gt; # the next element is i+1</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="396-标点符合-拼写和语法punctuation-spelling-and-grammar"><a class="markdownIt-Anchor" href="#396-标点符合-拼写和语法punctuation-spelling-and-grammar"></a> 3.9.6 标点符合、拼写和语法(Punctuation, Spelling and Grammar)</h4>
<p>大家都喜欢读一份写得很优雅的注释，而不是杂乱没有头绪的注释。注释应该是一段通顺的语句。完整的句子比一个片段可读性更强。</p>
<p>源代码保持高度的清晰度和可读性是非常重要的。适当的标点符号、词汇选择和语法是必要的。</p>
<h3 id="310-类classes"><a class="markdownIt-Anchor" href="#310-类classes"></a> 3.10 类(Classes)</h3>
<p>Python3起，默认的类都继承自<code>object</code>，不用再显式继承<code>object</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Okay: <span class="class"><span class="keyword">class</span> <span class="title">SampleClass</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">OuterClass</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">InnerClass</span>:</span></span><br><span class="line">            <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h3 id="311-字符串strings"><a class="markdownIt-Anchor" href="#311-字符串strings"></a> 3.11 字符串(Strings)</h3>
<p>使用%操作符或者格式化方法<code>format</code>格式化字符串。Python3.6提供了f-string ，参考<a href="https://www.python.org/dev/peps/pep-0498/" target="_blank" rel="noopener">PEP-498</a>。简单的情况使用<code>+</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Yes: x = a + b</span><br><span class="line">     x = <span class="string">'%s, %s!'</span> % (imperative, expletive)</span><br><span class="line">     x = <span class="string">'&#123;&#125;, &#123;&#125;'</span>.format(first, second)</span><br><span class="line">     x = <span class="string">'name: %s; score: %d'</span> % (name, n)</span><br><span class="line">     x = <span class="string">'name: &#123;&#125;; score: &#123;&#125;'</span>.format(name, n)</span><br><span class="line">     x = <span class="string">f'name: <span class="subst">&#123;name&#125;</span>; score: <span class="subst">&#123;n&#125;</span>'</span>  <span class="comment"># Python 3.6+</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">No: x = <span class="string">'%s%s'</span> % (a, b)  <span class="comment"># use + in this case</span></span><br><span class="line">    x = <span class="string">'&#123;&#125;&#123;&#125;'</span>.format(a, b)  <span class="comment"># use + in this case</span></span><br><span class="line">    x = first + <span class="string">', '</span> + second</span><br><span class="line">    x = <span class="string">'name: '</span> + name + <span class="string">'; score: '</span> + str(n)</span><br></pre></td></tr></table></figure>
<p>避免在循环中用<code>+</code>和<code>+=</code>操作符来累加字符串。 由于字符串是不可变的，这样做会创建不必要的临时对象，并且导致二次方而不是线性的运行时间。作为替代方案，你可以将每个子串加入列表，然后在循环结束后用 <code>.join</code> 连接列表。 (也可以将每个子串写入一个 <code>cStringIO.StringIO</code> 缓存中。)</p>
<p>虽然Cpython对<code>+</code>和<code>+=</code>进行了优化，速度比<code>join</code>还快，但是不建议依赖特定的解释器进行编程。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Yes: items = [<span class="string">'&lt;table&gt;'</span>]</span><br><span class="line">     <span class="keyword">for</span> last_name, first_name <span class="keyword">in</span> employee_list:</span><br><span class="line">         items.append(<span class="string">'&lt;tr&gt;&lt;td&gt;%s, %s&lt;/td&gt;&lt;/tr&gt;'</span> % (last_name, first_name))</span><br><span class="line">     items.append(<span class="string">'&lt;/table&gt;'</span>)</span><br><span class="line">     employee_table = <span class="string">''</span>.join(items)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">No: employee_table = <span class="string">'&lt;table&gt;'</span></span><br><span class="line">    <span class="keyword">for</span> last_name, first_name <span class="keyword">in</span> employee_list:</span><br><span class="line">        employee_table += <span class="string">'&lt;tr&gt;&lt;td&gt;%s, %s&lt;/td&gt;&lt;/tr&gt;'</span> % (last_name, first_name)</span><br><span class="line">    employee_table += <span class="string">'&lt;/table&gt;'</span></span><br></pre></td></tr></table></figure>
<p>在同一个文件中， 保持使用字符串引号的一致性。要么都是双引号，要么都是单引号， 在遇见字符串中有引号时，使用另一种引号。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Yes:</span><br><span class="line">     Python(<span class="string">'Why are you hiding your eyes?'</span>)</span><br><span class="line">     Gollum(<span class="string">"I'm scared of lint errors."</span>)</span><br><span class="line">     Narrator(<span class="string">'"Good!" thought a happy Python reviewer.'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">No:</span><br><span class="line">     Python(<span class="string">"Why are you hiding your eyes?"</span>)</span><br><span class="line">     Gollum(<span class="string">'The lint. It burns. It burns us.'</span>)</span><br><span class="line">     Gollum(<span class="string">"Always the great lint. Watching. Watching."</span>)</span><br></pre></td></tr></table></figure>
<p>为多行字符串使用三重双引号&quot;&quot;&quot;而非三重单引号’’’。多行字符串与程序其他部分的缩进方式不一致， 使用隐式行链接来替代。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Yes:</span><br><span class="line">print(<span class="string">"This is much nicer.\n"</span></span><br><span class="line">      <span class="string">"Do it this way.\n"</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  No:</span><br><span class="line">    print(<span class="string">"""This is pretty ugly.</span></span><br><span class="line"><span class="string">Don't do this.</span></span><br><span class="line"><span class="string">"""</span>)</span><br></pre></td></tr></table></figure>
<h3 id="312-文件和socketsfiles-and-sockets"><a class="markdownIt-Anchor" href="#312-文件和socketsfiles-and-sockets"></a> 3.12 文件和sockets(Files and Sockets)</h3>
<p>在文件和sockets结束时，显式的关闭它。</p>
<p>除文件外，sockets或其他类似文件的对象在没有必要的情况下打开，会有许多副作用，例如：</p>
<ol>
<li>它们可能会消耗有限的系统资源，如文件描述符。如果这些资源在使用后没有及时归还系统，那么用于处理这些对象的代码会将资源消耗殆尽。</li>
<li>持有文件将会阻止对于文件的其他诸如移动、删除之类的操作。</li>
<li>仅仅是从逻辑上关闭文件和sockets，那么它们仍然可能会被其共享的程序在无意中进行读或者写操作。 只有当它们真正被关闭后，对于它们尝试进行读或者写操作将会抛出异常，并使得问题快速显现出来。</li>
</ol>
<p>而且，对文件对象析构时，文件和sockets会自动关闭。</p>
<ol>
<li>不同的Python解释器实现了不同的gc。</li>
<li>对于文件意外的引用,会导致对于文件的持有时间超出预期(比如对于异常的跟踪, 包含有全局变量等).</li>
</ol>
<p>推荐使用<code>with</code>管理文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">"hello.txt"</span>) <span class="keyword">as</span> hello_file:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> hello_file:</span><br><span class="line">        <span class="keyword">print</span> line</span><br></pre></td></tr></table></figure>
<p>对于不支持<code>with</code>的类文件对象，使用<code>contextlib.closing()</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> contextlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> contextlib.closing(urllib.urlopen(<span class="string">"http://www.python.org/"</span>)) <span class="keyword">as</span> front_page:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> front_page:</span><br><span class="line">        print(line)</span><br></pre></td></tr></table></figure>
<h3 id="313-todo注释todo-comments"><a class="markdownIt-Anchor" href="#313-todo注释todo-comments"></a> 3.13 TODO注释(TODO  Comments)</h3>
<p>为临时代码使用TODO注释，它是一种短期解决方案。</p>
<p>TODO注释应该在所有开头处包含&quot;TODO&quot;字符串，紧跟着是用括号括起来的你的名字、email地址或其它标识符。然后是一个可选的冒号，接着必须有一行注释， 解释要做什么。</p>
<p>主要目的是为了有一个统一的TODO格式， 这样添加注释的人就可以搜索到他的注释。</p>
<p>写了TODO注释并不保证写的人会亲自解决问题。当你写了一个TODO，请注上你的名字。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TODO(kl@gmail.com): Use a "*" here for string repetition.</span></span><br><span class="line"><span class="comment"># TODO(Zeke) Change this to use relations.</span></span><br></pre></td></tr></table></figure>
<h3 id="314-导入格式化imports-formatting"><a class="markdownIt-Anchor" href="#314-导入格式化imports-formatting"></a> 3.14 导入格式化(Imports formatting)</h3>
<p>导入需要独占一行。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Yes: <span class="keyword">import</span> os</span><br><span class="line">     <span class="keyword">import</span> sys</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">No:  <span class="keyword">import</span> os, sys</span><br></pre></td></tr></table></figure>
<p>导入总应该放在文件顶部，位于模块注释和文档字符串之后，模块全局变量和常量之前。导入应该按照以下顺序分组:</p>
<ol>
<li>标准库导入，比如：<code>import sys</code></li>
<li>第三方库导入，比如：<code>import tensorflow as tf</code></li>
<li>应用程序指定导入，比如：<code>from otherproject.ai import mind</code></li>
</ol>
<p>导入的每一部分需要按字典序排序，忽略大小写。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"><span class="keyword">import</span> Queue</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> argcomplete</span><br><span class="line"><span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> cryptography</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> otherproject.ai <span class="keyword">import</span> body</span><br><span class="line"><span class="keyword">from</span> otherproject.ai <span class="keyword">import</span> mind</span><br><span class="line"><span class="keyword">from</span> otherproject.ai <span class="keyword">import</span> soul</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> myproject.backend.hgwells <span class="keyword">import</span> time_machine</span><br><span class="line"><span class="keyword">from</span> myproject.backend.state_machine <span class="keyword">import</span> main_loop</span><br></pre></td></tr></table></figure>
<h3 id="315-语句statements"><a class="markdownIt-Anchor" href="#315-语句statements"></a> 3.15 语句(Statements)</h3>
<p>通常每个语句独占一行。</p>
<p>不过， 如果仅仅只有if语句，可以把整个语句放在一行。 如果为了测试，临时这么做也是可以的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Yes:</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> foo: bar(foo)</span><br><span class="line">  <span class="keyword">import</span> pdb; pdb.set_trace()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">No:</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> foo: bar(foo)</span><br><span class="line">  <span class="keyword">else</span>:   baz(foo)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span>:               bar(foo)</span><br><span class="line">  <span class="keyword">except</span> ValueError: baz(foo)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span>:</span><br><span class="line">      bar(foo)</span><br><span class="line">  <span class="keyword">except</span> ValueError: baz(foo)</span><br></pre></td></tr></table></figure>
<h3 id="316-访问控制access-control"><a class="markdownIt-Anchor" href="#316-访问控制access-control"></a> 3.16 访问控制(Access Control)</h3>
<p>使用<code>@property</code>对属性进行控制，不要另外写<code>getter</code>和<code>setter</code>方法。</p>
<p>例外：如果逻辑非常复杂，或者调用非常频繁影响到性能，那么可以使用函数调用，需要遵守命名规则比如<code>set_foo()</code> <code>get_foo()</code>。</p>
<h3 id="317-命名naming"><a class="markdownIt-Anchor" href="#317-命名naming"></a> 3.17 命名(Naming)</h3>
<p>Python命名分为许多种类：</p>
<p><code>module_name</code>, <code>package_name</code>, <code>ClassName</code>, <code>method_name</code>, <code>ExceptionName</code>, <code>function_name</code>, <code>GLOBAL_CONSTANT_NAME</code>,<code>global_var_name</code>, <code>instance_var_name</code>, <code>function_parameter_name</code>, <code>local_var_name</code>。</p>
<h4 id="3171应该避免的名称"><a class="markdownIt-Anchor" href="#3171应该避免的名称"></a> 3.17.1应该避免的名称</h4>
<blockquote>
<ol>
<li>单字符名称， 除了计数器和迭代器。</li>
<li>包/模块名中的连字符(-)。</li>
<li>双下划线开头并结尾的名称(除了Python保留的例如__init__)。</li>
</ol>
</blockquote>
<h4 id="3172-命名约定"><a class="markdownIt-Anchor" href="#3172-命名约定"></a> 3.17.2 命名约定</h4>
<blockquote>
<ol>
<li>所谓&quot;内部(Internal)&quot;表示仅模块内可用，或者，在类内是保护或私有的。</li>
<li>用单下划线(_)开头表示模块变量或函数是protected的(使用import * from时不会包含)。</li>
<li>用双下划线(__)开头的实例变量或方法表示类内私有。</li>
<li>将相关的类和顶层函数放在同一个模块里。不像Java，没必要限制一个类一个模块。</li>
<li>对类名使用大写字母开头的单词(如CapWords, 即Pascal风格)，但是模块名应该用小写加下划线的方式(如lower_with_under.py)。尽管已经有很多现存的模块使用类似于CapWords.py这样的命名，但现在已经不鼓励这样做，因为如果模块名碰巧和类名一致，这会让人困扰。</li>
</ol>
</blockquote>
<h4 id="3173-文件命名"><a class="markdownIt-Anchor" href="#3173-文件命名"></a> 3.17.3 文件命名</h4>
<p>Python文件名必须是<code>.py</code>的扩展名，不能包含连字符(<code>-</code>)。因此这些文件可以被导入和单元测试。如果你想要一个没有扩展名的可执行文件，使用软链接或者是一个bash来包装 <code>exec &quot;$0.py&quot; &quot;$@&quot;</code>。</p>
<h4 id="3174-guido-van-rossum推荐的命名规范"><a class="markdownIt-Anchor" href="#3174-guido-van-rossum推荐的命名规范"></a> 3.17.4 Guido van Rossum推荐的命名规范</h4>
<table>
<thead>
<tr>
<th>类型(Type)</th>
<th>公共(Public)</th>
<th>内部(Internal)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Packages</td>
<td><code>lower_with_under</code></td>
<td></td>
</tr>
<tr>
<td>Modules</td>
<td><code>lower_with_under</code></td>
<td><code>_lower_with_under</code></td>
</tr>
<tr>
<td>Classes</td>
<td><code>CapWords</code></td>
<td><code>_CapWords</code></td>
</tr>
<tr>
<td>Exceptions</td>
<td><code>CapWords</code></td>
<td></td>
</tr>
<tr>
<td>Functions</td>
<td><code>lower_with_under()</code></td>
<td><code>_lower_with_under()</code></td>
</tr>
<tr>
<td>Global/Class Constants</td>
<td><code>CAPS_WITH_UNDER</code></td>
<td><code>_CAPS_WITH_UNDER</code></td>
</tr>
<tr>
<td>Global/Class Variables</td>
<td><code>lower_with_under</code></td>
<td><code>_lower_with_under</code></td>
</tr>
<tr>
<td>Instance Variables</td>
<td><code>lower_with_under</code></td>
<td><code>_lower_with_under</code> (protected)</td>
</tr>
<tr>
<td>Method Names</td>
<td><code>lower_with_under()</code></td>
<td><code>_lower_with_under()</code> (protected)</td>
</tr>
<tr>
<td>Function/Method Parameters</td>
<td><code>lower_with_under</code></td>
<td></td>
</tr>
<tr>
<td>Local Variables</td>
<td><code>lower_with_under</code></td>
<td></td>
</tr>
</tbody>
</table>
<p>Python 通过双下划线命名来支持私有变量。但是最好使用单下划线来作为内部变量访问。</p>
<h3 id="318-主函数main"><a class="markdownIt-Anchor" href="#318-主函数main"></a> 3.18 主函数(Main)</h3>
<p>每一个可执行脚本都应该能被导入，并且导入不会执行这个脚本的主要功能部分。 主要功能部分应该被放在主函数中。</p>
<p>代码在执行主程序前应该检查<code>if __name__ == '__main__'</code>，这样当模块被导入时，这部分代码就不会被执行。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>所有的顶层代码在模块导入时都会被执行。因此要小心在全局中调用函数，创建对象的操作，需要测试的代码写在<code>if __name__ == '__main__'</code>下面。</p>
<h3 id="319-函数长度function-length"><a class="markdownIt-Anchor" href="#319-函数长度function-length"></a> 3.19 函数长度(Function length)</h3>
<p>推荐使用小而精的函数。</p>
<p>有时候一段比较长的函数是比较合适的，所以这里不会过多地限制函数的长度。如果一个函数超过40行，那么要考虑一下它是否能被合理地拆分。一个很长的函数可能在这个需求下是适用的，并且没有bug，但是如果新增了需求需要对它进行改动，在多次改动后可能会导致难以找到的bug。函数应该是简洁明了，易于他人维护的。</p>
<p>如果你正好遇到一个函数代码量非常地长并且复杂，那么最好先把它拆分为多个函数易于管理。不要觉得拆分是一件很困难的事情，为了你的长远考虑，我建议你这么做。</p>
<h3 id="320-类型注释type-annotations"><a class="markdownIt-Anchor" href="#320-类型注释type-annotations"></a> 3.20 类型注释(Type Annotations)</h3>
<h4 id="3201-一般规则"><a class="markdownIt-Anchor" href="#3201-一般规则"></a> 3.20.1 一般规则</h4>
<ul>
<li>了解<a href="https://www.python.org/dev/peps/pep-0484/" target="_blank" rel="noopener">PEP-484</a>。</li>
<li>不要在方法中注释<code>self</code>和<code>cls</code>。</li>
<li>如果变量或返回值不明确，使用<code>Any</code>。</li>
<li>不要求注释所有的函数。
<ul>
<li>至少注释公共API。</li>
<li>在明确和灵活之间做一个平衡。</li>
<li>注释的代码相对难理解。</li>
<li>注释代码是一个稳妥的做法，对一段成熟的代码一定要进行注释。</li>
<li>注释代码可以发现类型相关的错误。</li>
</ul>
</li>
</ul>
<h2 id="5-临别赠言"><a class="markdownIt-Anchor" href="#5-临别赠言"></a> 5 临别赠言</h2>
<p><code>务必保持代码的一致性</code></p>
<p>如果你正在编辑代码，花几分钟看一下周边代码，然后决定风格。如果它们在所有的算术操作符两边都使用空格，那么你也应该这样做，如果它们的注释都用标记包围起来，那么你的注释也要这样。</p>
<p>制定风格指南的目的在于让代码有规可循，这样人们就可以专注于&quot;你在说什么&quot;，而不是&quot;你在怎么说&quot;。我们在这里给出的是全局的规范，但是本地的规范同样重要。如果你加到一个文件里的代码和原有代码大相径庭，它会让读者不知所措，请避免这种情况。</p>
<p>作者：倪侃（859905874@qq.com）</p>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    Leo Ni
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://nikan1996.coding.me/2018/07/30/PythonCodeStyle/Python编码风格规范/" title="Python编码风格规范">http://nikan1996.coding.me/2018/07/30/PythonCodeStyle/Python编码风格规范/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/codestyle-python/" rel="tag"># codestyle python</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/07/29/Me/关于我/" rel="next" title="简历">
                <i class="fa fa-chevron-left"></i> 简历
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/07/30/AIOHTTP-And-Tornado-Benchmark/" rel="prev" title="AIOHTTP和Tornado的性能测试比较">
                AIOHTTP和Tornado的性能测试比较 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="http://qiniu-blog.cyhlucky.club/fengbaobao.jpg"
                alt="Leo Ni" />
            
              <p class="site-author-name" itemprop="name">Leo Ni</p>
              <p class="site-description motion-element" itemprop="description">运气跟努力，都同样重要。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#python编程规范"><span class="nav-text"> Python编程规范</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-背景"><span class="nav-text"> 1 背景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-语言规范"><span class="nav-text"> 2 语言规范</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#21-代码检查工具"><span class="nav-text"> 2.1 代码检查工具</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#211-解释"><span class="nav-text"> 2.1.1 解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#212-优点"><span class="nav-text"> 2.1.2 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#213-缺点"><span class="nav-text"> 2.1.3 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#214-推荐"><span class="nav-text"> 2.1.4 推荐</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#22-导入imports"><span class="nav-text"> 2.2 导入(Imports)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#221-解释"><span class="nav-text"> 2.2.1 解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#222-优点"><span class="nav-text"> 2.2.2 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#223-缺点"><span class="nav-text"> 2.2.3 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#224-推荐"><span class="nav-text"> 2.2.4 推荐</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#23-包packages"><span class="nav-text"> 2.3 包(Packages)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#231-解释"><span class="nav-text"> 2.3.1 解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#232-优点"><span class="nav-text"> 2.3.2 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#233-缺点"><span class="nav-text"> 2.3.3 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#234-推荐"><span class="nav-text"> 2.3.4 推荐</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#24-异常exceptions"><span class="nav-text"> 2.4 异常(Exceptions)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#241-解释"><span class="nav-text"> 2.4.1 解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#242-优点"><span class="nav-text"> 2.4.2 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#243-缺点"><span class="nav-text"> 2.4.3 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#244-推荐"><span class="nav-text"> 2.4.4 推荐</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#25-全局变量global-variables"><span class="nav-text"> 2.5 全局变量(Global variables)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#251-解释"><span class="nav-text"> 2.5.1 解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#252-优点"><span class="nav-text"> 2.5.2 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#253-缺点"><span class="nav-text"> 2.5.3 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#254-推荐"><span class="nav-text"> 2.5.4 推荐</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#26-嵌套-局部-内部类和函数nestedlocalinner-classes-and-functions"><span class="nav-text"> 2.6 嵌套、局部、内部类和函数(Nested/Local/Inner Classes and Functions)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#261-解释"><span class="nav-text"> 2.6.1 解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#262-优点"><span class="nav-text"> 2.6.2 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#263-缺点"><span class="nav-text"> 2.6.3 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#264-推荐"><span class="nav-text"> 2.6.4 推荐</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#27-推导式和生成器表达式comprehensions-generator-expressions"><span class="nav-text"> 2.7 推导式和生成器表达式(Comprehensions &amp; Generator Expressions)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#271-解释"><span class="nav-text"> 2.7.1 解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#272-优点"><span class="nav-text"> 2.7.2 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#273-缺点"><span class="nav-text"> 2.7.3 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#274-推荐"><span class="nav-text"> 2.7.4 推荐</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#28-默认迭代器和操作符default-iterators-and-operators"><span class="nav-text"> 2.8 默认迭代器和操作符(Default Iterators and Operators)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#281-解释"><span class="nav-text"> 2.8.1 解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#282-优点"><span class="nav-text"> 2.8.2 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#283-缺点"><span class="nav-text"> 2.8.3 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#284-推荐"><span class="nav-text"> 2.8.4 推荐</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#29-生成器generators"><span class="nav-text"> 2.9 生成器(Generators)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#291-解释"><span class="nav-text"> 2.9.1 解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#292-优点"><span class="nav-text"> 2.9.2 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#293-缺点"><span class="nav-text"> 2.9.3 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#294-推荐"><span class="nav-text"> 2.9.4 推荐</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#210-匿名函数lambda-functions"><span class="nav-text"> 2.10 匿名函数(Lambda Functions)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2101-解释"><span class="nav-text"> 2.10.1 解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2102-优点"><span class="nav-text"> 2.10.2 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2103-缺点"><span class="nav-text"> 2.10.3 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2104-推荐"><span class="nav-text"> 2.10.4 推荐</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#211-条件表达式conditional-expressions"><span class="nav-text"> 2.11 条件表达式(Conditional Expressions)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2111-解释"><span class="nav-text"> 2.11.1 解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2112-优点"><span class="nav-text"> 2.11.2 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2113-缺点"><span class="nav-text"> 2.11.3 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2114-推荐"><span class="nav-text"> 2.11.4 推荐</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#212-默认参数值default-argument-values"><span class="nav-text"> 2.12 默认参数值(Default Argument Values)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2121-解释"><span class="nav-text"> 2.12.1 解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2122-优点"><span class="nav-text"> 2.12.2 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2123-缺点"><span class="nav-text"> 2.12.3 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2124-推荐"><span class="nav-text"> 2.12.4 推荐</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#213-属性properties"><span class="nav-text"> 2.13 属性(Properties)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2131-解释"><span class="nav-text"> 2.13.1 解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2132-优点"><span class="nav-text"> 2.13.2 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2133-缺点"><span class="nav-text"> 2.13.3 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2134-推荐"><span class="nav-text"> 2.13.4 推荐</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#214-truefalse的求值truefalse-evaluations"><span class="nav-text"> 2.14 True/False的求值(True/False evaluations)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2141-解释"><span class="nav-text"> 2.14.1 解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2142-优点"><span class="nav-text"> 2.14.2 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2143-缺点"><span class="nav-text"> 2.14.3 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2144-推荐"><span class="nav-text"> 2.14.4 推荐</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#215-过时的语言特性deprecated-language-features"><span class="nav-text"> 2.15 过时的语言特性(Deprecated Language Features)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2151-解释"><span class="nav-text"> 2.15.1 解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2152-推荐"><span class="nav-text"> 2.15.2 推荐</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#216-变量作用域lexical-scoping"><span class="nav-text"> 2.16 变量作用域(Lexical Scoping)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2161-解释"><span class="nav-text"> 2.16.1 解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2162-优点"><span class="nav-text"> 2.16.2 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2163-缺点"><span class="nav-text"> 2.16.3 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2164-推荐"><span class="nav-text"> 2.16.4 推荐</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#217-函数和方法装饰器function-and-method-decorators"><span class="nav-text"> 2.17 函数和方法装饰器(Function and Method Decorators)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2171-解释"><span class="nav-text"> 2.17.1 解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2172-优点"><span class="nav-text"> 2.17.2 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2173-缺点"><span class="nav-text"> 2.17.3 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2174-推荐"><span class="nav-text"> 2.17.4 推荐</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#218-线程threading"><span class="nav-text"> 2.18 线程(Threading)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2181-推荐"><span class="nav-text"> 2.18.1 推荐</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#219-强大的特性power-features"><span class="nav-text"> 2.19 强大的特性(Power Features)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2191-解释"><span class="nav-text"> 2.19.1 解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2192-优点"><span class="nav-text"> 2.19.2 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2193-缺点"><span class="nav-text"> 2.19.3 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2194-推荐"><span class="nav-text"> 2.19.4 推荐</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#220-现代化pythonmodern-python-python-3-and-from-_future_-imports"><span class="nav-text"> 2.20 现代化Python(Modern Python: Python 3 and from _future_ imports)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2201-解释"><span class="nav-text"> 2.20.1 解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2202-优点"><span class="nav-text"> 2.20.2 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2203-缺点"><span class="nav-text"> 2.20.3 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2204-推荐"><span class="nav-text"> 2.20.4 推荐</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#221-代码类型注释type-annotated-code"><span class="nav-text"> 2.21 代码类型注释(Type Annotated Code)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2211-解释"><span class="nav-text"> 2.21.1 解释</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2212-优点"><span class="nav-text"> 2.21.2 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2213-缺点"><span class="nav-text"> 2.21.3 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2214-推荐"><span class="nav-text"> 2.21.4 推荐</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-python风格规范"><span class="nav-text"> 3 Python风格规范</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#31-代码格式化工具"><span class="nav-text"> 3.1 代码格式化工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#32-分号semicolons"><span class="nav-text"> 3.2 分号(Semicolons)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#33-行长度line-length"><span class="nav-text"> 3.3 行长度(Line length)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#34-括号parentheses"><span class="nav-text"> 3.4 括号(Parentheses)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#35-缩进indentation"><span class="nav-text"> 3.5 缩进(Indentation)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#36-空行blank-lines"><span class="nav-text"> 3.6 空行(Blank Lines)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#37-空格whitespace"><span class="nav-text"> 3.7 空格(Whitespace)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#38-shebang行shebang-line"><span class="nav-text"> 3.8 SheBang行(Shebang Line)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#39-注释和文档字符串comments-and-docstrings"><span class="nav-text"> 3.9 注释和文档字符串(Comments and Docstrings)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#391-文档字符串docstrings"><span class="nav-text"> 3.9.1 文档字符串(Docstrings)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#392-模块modules"><span class="nav-text"> 3.9.2 模块(Modules)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#393-函数和方法functions-and-methods"><span class="nav-text"> 3.9.3 函数和方法(Functions and Methods)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#394-类classes"><span class="nav-text"> 3.9.4 类(Classes)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#395-块注释和行注释block-and-inline-comments"><span class="nav-text"> 3.9.5 块注释和行注释(Block and Inline Comments)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#396-标点符合-拼写和语法punctuation-spelling-and-grammar"><span class="nav-text"> 3.9.6 标点符合、拼写和语法(Punctuation, Spelling and Grammar)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#310-类classes"><span class="nav-text"> 3.10 类(Classes)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#311-字符串strings"><span class="nav-text"> 3.11 字符串(Strings)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#312-文件和socketsfiles-and-sockets"><span class="nav-text"> 3.12 文件和sockets(Files and Sockets)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#313-todo注释todo-comments"><span class="nav-text"> 3.13 TODO注释(TODO  Comments)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#314-导入格式化imports-formatting"><span class="nav-text"> 3.14 导入格式化(Imports formatting)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#315-语句statements"><span class="nav-text"> 3.15 语句(Statements)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#316-访问控制access-control"><span class="nav-text"> 3.16 访问控制(Access Control)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#317-命名naming"><span class="nav-text"> 3.17 命名(Naming)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3171应该避免的名称"><span class="nav-text"> 3.17.1应该避免的名称</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3172-命名约定"><span class="nav-text"> 3.17.2 命名约定</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3173-文件命名"><span class="nav-text"> 3.17.3 文件命名</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3174-guido-van-rossum推荐的命名规范"><span class="nav-text"> 3.17.4 Guido van Rossum推荐的命名规范</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#318-主函数main"><span class="nav-text"> 3.18 主函数(Main)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#319-函数长度function-length"><span class="nav-text"> 3.19 函数长度(Function length)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#320-类型注释type-annotations"><span class="nav-text"> 3.20 类型注释(Type Annotations)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3201-一般规则"><span class="nav-text"> 3.20.1 一般规则</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-临别赠言"><span class="nav-text"> 5 临别赠言</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Leo Ni</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  









  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three-waves.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("6EvN3vQIpoWOHjanSlb3Kqkq-gzGzoHsz", "SIBUrF6H4IjHul477C2vlYWu");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
